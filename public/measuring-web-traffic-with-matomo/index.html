

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Measuring web traffic with Matomo - Zoltán&#39;s Blog</title>
  <meta name="description" content="You get what you measure">
  <meta name="author" content="Zoltán Balogh"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Zoltán\u0027s Blog",
    
    "url": "https:\/\/bzoltan1.github.io\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/bzoltan1.github.io\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/bzoltan1.github.io\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/bzoltan1.github.io\/measuring-web-traffic-with-matomo\/",
          "name": "Measuring web traffic with matomo"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : ""
  },
  "headline": "Measuring web traffic with Matomo",
  "description" : "Matomo is an open source PHP\/MySQL based web analytics application to track online visits to websites and displays reports on these visits. It does what Google Analytics does, but it is open source. Matomo has commercial cloud based offering for those who do not want to host their own instance but the code is there on GitHub (https:\/\/github.com\/matomo-org\/matomo) for anyone who is interested.\nI decided to first test drive the cloud based solution and then install my own instance.",
  "inLanguage" : "en",
  "wordCount":  880 ,
  "datePublished" : "2021-04-22T20:40:57\u002b03:00",
  "dateModified" : "2021-04-22T20:40:57\u002b03:00",
  "image" : "https:\/\/bzoltan1.github.io\/avatar.png",
  "keywords" : [ "matomo, haproxy, letsencrypt, website, opensuse" ],
  "mainEntityOfPage" : "https:\/\/bzoltan1.github.io\/measuring-web-traffic-with-matomo\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/bzoltan1.github.io\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/bzoltan1.github.io\/avatar.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="Measuring web traffic with Matomo" />
<meta property="og:description" content="You get what you measure">
<meta property="og:image" content="https://bzoltan1.github.io/avatar.png" />
<meta property="og:url" content="https://bzoltan1.github.io/measuring-web-traffic-with-matomo/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Zoltán&#39;s Blog" />

  <meta name="twitter:title" content="Measuring web traffic with Matomo" />
  <meta name="twitter:description" content="You get what you measure">
  <meta name="twitter:image" content="https://bzoltan1.github.io/avatar.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='https://bzoltan1.github.io/avatar.png' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.83.1" />
  <link rel="alternate" href="https://bzoltan1.github.io/index.xml" type="application/rss+xml" title="Zoltán&#39;s Blog"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://bzoltan1.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://bzoltan1.github.io/css/syntax.css" /><link rel="stylesheet" href="https://bzoltan1.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://bzoltan1.github.io/">Zoltán&#39;s Blog</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="https://bzoltan1.github.io/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="https://bzoltan1.github.io/tags">Tags</a>
            </li>
          
        
          
            <li>
              <a title="Home" href="https://bzoltan1.github.io/">Home</a>
            </li>
          
        
          
            <li>
              <a title="About" href="https://bzoltan1.github.io/about">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Zoltán&#39;s Blog" href="https://bzoltan1.github.io/">
            <img class="avatar-img" src="https://bzoltan1.github.io/avatar.png" alt="Zoltán&#39;s Blog" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Measuring web traffic with Matomo</h1>
              
              
              
                
                  <h2 class="post-subheading">You get what you measure</h2>
                
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on April 22, 2021
  
  
  
  
    
      &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>Matomo is an open source PHP/MySQL  based web analytics application to track online visits to websites and displays reports on these visits. It does what Google Analytics does, but it is open source. Matomo has commercial cloud based offering for those who do not want to host their own instance but the code is there on GitHub (<a href="https://github.com/matomo-org/matomo">https://github.com/matomo-org/matomo</a>) for anyone who is interested.</p>
<p>I decided to first test drive the cloud based solution and then install my own instance. </p>
<h3 id="test-drive-on-the-cloud">Test drive on the cloud</h3>
<p>This was a boringly simple and straight forward job. Just visited the <a href="https://matomo.org/start-free-analytics-trial/">https://matomo.org/start-free-analytics-trial/</a> and signed up my <a href="https://bzoltan1.github.io/">https://bzoltan1.github.io/</a> for the 21 day free trial period.</p>
<p>The only hurdle to jump over was to inject the tracker script to the Hugo base. </p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">cd</span> blog-source  
mkdir -p layouts/partials  
cp themes/beautifulhugo/layouts/partials/head.html ./layouts/partials/head.html
</code></pre></div><p>And then copy and paste the script what the Matomo page shows to the end of the head.html template. To me it was like this</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!-- Matomo --&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="mi">_</span><span class="nx">paq</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="mi">_</span><span class="nx">paq</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="mi">_</span><span class="nx">paq</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="cm">/* tracker methods like &#34;setCustomDimension&#34; should be called before &#34;trackPageView&#34; */</span>
    <span class="mi">_</span><span class="nx">paq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s1">&#39;trackPageView&#39;</span><span class="p">]);</span>
    <span class="mi">_</span><span class="nx">paq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s1">&#39;enableLinkTracking&#39;</span><span class="p">]);</span>
    <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">u</span><span class="o">=</span><span class="s2">&#34;https://bzoltan1.matomo.cloud/&#34;</span><span class="p">;</span>
        <span class="mi">_</span><span class="nx">paq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s1">&#39;setTrackerUrl&#39;</span><span class="p">,</span> <span class="nx">u</span><span class="o">+</span><span class="s1">&#39;matomo.php&#39;</span><span class="p">]);</span>
        <span class="mi">_</span><span class="nx">paq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s1">&#39;setSiteId&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]);</span>
        <span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="nb">document</span><span class="p">,</span> <span class="nx">g</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">),</span> <span class="nx">s</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">g</span><span class="p">.</span><span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text/javascript&#39;</span><span class="p">;</span> <span class="nx">g</span><span class="p">.</span><span class="kr">async</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span> <span class="nx">g</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s1">&#39;//cdn.matomo.cloud/bzoltan1.matomo.cloud/matomo.js&#39;</span><span class="p">;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span><span class="nx">s</span><span class="p">);</span>
    <span class="p">})();</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="c">&lt;!-- End Matomo Code --&gt;</span>
</code></pre></div><p>After deploying this change the <a href="https://bzoltan1.matomo.cloud">https://bzoltan1.matomo.cloud</a> started to show numbers.</p>
<p>That was easy. But my motivation to go away from Google Analytics was that I do not necessarily want to share with anybody the data I collect from my visitors.</p>
<h3 id="installing-matomo">Installing Matomo</h3>
<p>My server is running on beta Leap 15.3 and it has matomo available in the repository.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo zypper in matomo
</code></pre></div><p>This installs Matomo under <code>/srv/www/matomo</code> what I am not entirely happy as on my system the default webroot is <code>/srv/www/htdocs</code>. That actually will cause a tiny cosmetic issue later on.</p>
<p>I needed to set up the database and the database user in MariaDB</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">matomo_db</span><span class="p">;</span><span class="w">  
</span><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">matomouser</span><span class="o">@</span><span class="n">localhost</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;[password]&#39;</span><span class="p">;</span><span class="w">  
</span><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="k">INSERT</span><span class="p">,</span><span class="w"> </span><span class="k">UPDATE</span><span class="p">,</span><span class="w"> </span><span class="k">DELETE</span><span class="p">,</span><span class="w"> </span><span class="k">CREATE</span><span class="p">,</span><span class="w"> </span><span class="k">INDEX</span><span class="p">,</span><span class="w"> </span><span class="k">DROP</span><span class="p">,</span><span class="w"> </span><span class="k">ALTER</span><span class="p">,</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TEMPORARY</span><span class="w"> </span><span class="n">TABLES</span><span class="p">,</span><span class="w"> </span><span class="k">LOCK</span><span class="w"> </span><span class="n">TABLES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">matomo_db</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">matomouser</span><span class="o">@</span><span class="n">localhost</span><span class="p">;</span><span class="w">  
</span><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="n">FILE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">matomouser</span><span class="o">@</span><span class="n">localhost</span><span class="p">;</span><span class="w">
</span></code></pre></div><p>Naturally the <code>matomo_db</code> and <code>matomouser</code> may be different than the default in the manuals. But I prefer using vanilla names.</p>
<p>At that point I needed to stop a bit. My system is based on Apache2 webserver with HAProxy load balancer and with Let&rsquo;s Encrypt certifications. So I needed to teach my Apache where to find the webroot for Matomo.</p>
<p>I created <code>/etc/apache2/vhosts.d/matomo.conf</code> file with the following content</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;VirtualHost</span> <span class="err">matomo.nokedli.local:8080</span><span class="nt">&gt;</span>  
   DocumentRoot &#34;/srv/www/matomo/&#34;  
   ServerName matomo.nokedli.org  
   <span class="nt">&lt;Directory</span> <span class="err">/srv/www/matomo</span><span class="nt">/&gt;</span>  
      Require all granted  
      AllowOverride All  
      Options FollowSymLinks MultiViews  
      DirectoryIndex index.php  
      <span class="nt">&lt;IfModule</span> <span class="err">mod\_dav.c</span><span class="nt">&gt;</span>  
         Dav off  
      <span class="nt">&lt;/IfModule&gt;</span>  
    <span class="nt">&lt;/Directory&gt;</span>  
<span class="nt">&lt;/VirtualHost&gt;</span>
</code></pre></div><p>I have extended my HAProxy  configuration <code>/etc/haproxy/haproxy.cfg</code> to contain  the routing information</p>
<pre><code>frontend all_443
  mode http
  # that following line comes after the certificate was successfully created
  bind *:443 ssl crt /etc/ssl/matomo.nokedli.org/matomo.nokedli.org.pem 
  http-request set-header X-Forwarded-Proto https if { ssl_fc }
  acl lets_encrypt path_beg /.well-known/acme-challenge/
  use_backend lets_encrypt if lets_encrypt
  use_backend matomo-server if { ssl_fc_sni_end matomo.nokedli.org }
  use_backend matomo-server if { ssl_fc_sni_end matomo.nokedli.local }

frontend fe-nokedli
  bind *:80
  mode http
  option httplog
  redirect scheme https code 301 if !{ ssl_fc }
  acl lets_encrypt path_beg /.well-known/acme-challenge/
  use_backend lets_encrypt if lets_encrypt
  acl is_matomo hdr_beg(host) -i matomo.nokedli.local
  acl is_matomo hdr_beg(host) -i matomo.nokedli.org
  use_backend matomo-server if is_matomo
  default_backend be-nokedli

backend lets_encrypt
  mode http
  server local localhost:54321

# default Backend
backend be-nokedli
  # Config omitted here

# Matomo Backend
backend matomo-server
  server matomo-server matomo.nokedli.local:8080
</code></pre><p>Then I created the Let&rsquo;s Encrypt certificate</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">bash -c <span class="s2">&#34;mkdir -p /etc/ssl/matomo.nokedli.org/ &amp;&amp; cd /etc/letsencrypt/live/matomo.nokedli.org/ &amp;&amp; cat fullchain.pem privkey.pem &gt; /etc/ssl/matomo.nokedli.org/matomo.nokedli.org.pem&#34;</span>
</code></pre></div><p>and added the <code>/etc/ssl/matomo.nokedli.org/matomo.nokedli.org.pem</code> to the <code>/etc/haproxy/haproxy.cfg</code></p>
<p>And at the end I needed to fix apparmor to let the haproxy access the PEM file, so the <code>/etc/apparmor.d/local/usr.sbin.haproxy</code> need to contain <code>/etc/ssl/matomo.nokedli.org/* r,</code></p>
<p>After that visiting the <a href="https://matomo.nokedli.org/index.php">https://matomo.nokedli.org/index.php</a> I could do the actual installation of the Matomo. There is not much to record about that process. I simple entered the username, password and database what I have created and used with the SQL commands above.</p>
<p>And then replace the script in the head.html to this</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="c">&lt;!-- Matomo --&gt;</span>  
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/javascript&#34;</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="mi">_</span><span class="nx">paq</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="mi">_</span><span class="nx">paq</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="cm">/* tracker methods like &#34;setCustomDimension&#34; should be called before &#34;trackPageView&#34; */</span>
    <span class="mi">_</span><span class="nx">paq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s1">&#39;trackPageView&#39;</span><span class="p">]);</span>
    <span class="mi">_</span><span class="nx">paq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s1">&#39;enableLinkTracking&#39;</span><span class="p">]);</span>
    <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">u</span><span class="o">=</span><span class="s2">&#34;//matomo.nokedli.org/&#34;</span><span class="p">;</span>
        <span class="mi">_</span><span class="nx">paq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s1">&#39;setTrackerUrl&#39;</span><span class="p">,</span> <span class="nx">u</span><span class="o">+</span><span class="s1">&#39;matomo.php&#39;</span><span class="p">]);</span>
        <span class="mi">_</span><span class="nx">paq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s1">&#39;setSiteId&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">]);</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="nb">document</span><span class="p">,</span> <span class="nx">g</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">),</span> <span class="nx">s</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">g</span><span class="p">.</span><span class="nx">type</span><span class="o">=</span><span class="s1">&#39;text/javascript&#39;</span><span class="p">;</span> <span class="nx">g</span><span class="p">.</span><span class="kr">async</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span> <span class="nx">g</span><span class="p">.</span><span class="nx">defer</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span> <span class="nx">g</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="nx">u</span><span class="o">+</span><span class="s1">&#39;matomo.js&#39;</span><span class="p">;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span><span class="nx">s</span><span class="p">);</span>
    <span class="p">})();</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="c">&lt;!-- End Matomo Code --&gt;</span>  
</code></pre></div><p> 
What I am not happy with is that I need to use the <a href="https://matomo.nokedli.org/index.php">https://matomo.nokedli.org/index.php</a> address with the <code>index.php</code> even if the <code>.htaccess</code> and the vhost configuration is configured to default to the index.php. My assumption is that there is access permission problem when the application&rsquo;s root is outside of the apache&rsquo;s webroot. I wonder why matomo is installed to the <code>/srv/www/</code> instead of the more appropriate <code>/srv/www/htdocs/</code>. I could be very wrong here, if somebody knows the solution please get in touch with me.</p>
<p><strong>UPDATE on 23.04</strong></p>
<p>Thanks for the help of <a href="https://github.com/baierjan">Jan Bayer</a> we managed to figure out what caused the problem of accessing the root of the matomo. The <code>.htaccess</code> was  unnecessary and actually the root of the application was not the root :) cause of the problem.</p>
<p>The solution was to add to the VirtualHost section in the  <code>/etc/apache2/vhosts.d/matomo.conf</code> file the following section</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"> <span class="nt">&lt;Location</span> <span class="err">&#34;/&#34;</span><span class="nt">&gt;</span>
    Require all granted
 <span class="nt">&lt;/Location&gt;</span>
</code></pre></div><p>Most likely there was a conflict with an other webapp provided by the same web server what includes configuration snippets which affects global settings. Apache has a very complex configuration system. No wonder that it is safer and easier to deploy and maintain containerized webapps.</p>


        
          <div class="blog-tags">
            
              
              <a href="https://bzoltan1.github.io/tags/matomo/">matomo</a>&nbsp;
            
              
              <a href="https://bzoltan1.github.io/tags/haproxy/">haproxy</a>&nbsp;
            
              
              <a href="https://bzoltan1.github.io/tags/letsencrypt/">letsencrypt</a>&nbsp;
            
              
              <a href="https://bzoltan1.github.io/tags/website/">website</a>&nbsp;
            
              
              <a href="https://bzoltan1.github.io/tags/opensuse/">opensuse</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://bzoltan1.github.io/private-cloud-based-on-opensuse-leap-15.3-beta-and-nextcloud/" data-toggle="tooltip" data-placement="top" title="Private cloud based on openSUSE Leap 15.3 beta and Nextcloud">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://bzoltan1.github.io/playing-with-shelly/" data-toggle="tooltip" data-placement="top" title="Playing with Shelly">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            2021
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://bzoltan1.github.io/">Zoltán&#39;s Blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.83.1</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://bzoltan1.github.io/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://bzoltan1.github.io/js/load-photoswipe.js"></script>










    
  </body>
</html>

